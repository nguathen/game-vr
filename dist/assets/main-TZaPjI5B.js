import{a as m}from"./auth-manager-DjZ92ISH.js";import{G as b,W as g}from"./weapon-system-BnhBiZik.js";import"./audio-manager-BoM9ZqFN.js";let f="timeAttack",d="pistol";function h(e,{x:t,y:n,width:s,height:c,label:a,value:r,selected:l}){const i=document.createElement("a-plane");i.classList.add("clickable"),i.setAttribute("position",`${t} ${n} 0`),i.setAttribute("width",s),i.setAttribute("height",c),i.setAttribute("color",l?"#00d4ff":"#1a1a4e"),i.setAttribute("material","shader: flat; opacity: 0.85"),i.dataset.value=r;const o=document.createElement("a-text");return o.setAttribute("value",a),o.setAttribute("align","center"),o.setAttribute("color",l?"#ffffff":"#aaaacc"),o.setAttribute("width",s*3.5),o.setAttribute("position","0 0 0.01"),i.appendChild(o),e.appendChild(i),i}function v(e){const t=document.getElementById("mode-buttons");t.innerHTML="";const n=Object.values(b),s=-(n.length-1)*.85/2;n.forEach((c,a)=>{const r=e.level>=c.unlockLevel,l=r?`${c.icon} ${c.name}`:`Lv.${c.unlockLevel}`,i=h(t,{x:s+a*.85,y:0,width:.75,height:.3,label:l,value:c.id,selected:c.id===f});r&&i.addEventListener("click",()=>{f=c.id,v(e)})})}function E(e){const t=document.getElementById("weapon-buttons");t.innerHTML="";const n=Object.values(g),s=-(n.length-1)*.85/2;n.forEach((c,a)=>{const r=e.level>=c.unlockLevel,l=r?`${c.icon} ${c.name}`:`Lv.${c.unlockLevel}`,i=h(t,{x:s+a*.85,y:0,width:.75,height:.3,label:l,value:c.id,selected:c.id===d});r&&i.addEventListener("click",()=>{d=c.id,E(e)})})}function p(e){d=e.selectedWeapon||"pistol";const t=document.getElementById("player-info");t&&t.setAttribute("value",`Lv.${e.level} | ${e.coins} Coins`),v(e),E(e);const n=document.getElementById("btn-play-vr");n&&n.addEventListener("click",()=>{window.location.href=`./game.html?mode=${f}&weapon=${d}&theme=cyber`})}function y(e){const t=e.canvas;if(!t)return;const n=new THREE.Raycaster,s=new THREE.Vector2;t.addEventListener("click",c=>{const a=t.getBoundingClientRect();s.x=(c.clientX-a.left)/a.width*2-1,s.y=-((c.clientY-a.top)/a.height)*2+1;const r=e.camera;n.setFromCamera(s,r);const l=[];e.querySelectorAll(".clickable").forEach(o=>{o.object3D&&o.object3D.traverse(u=>{u.isMesh&&(u.__aframeEl=o,l.push(u))})});const i=n.intersectObjects(l,!1);if(i.length>0){const o=i[0].object.__aframeEl;o&&o.emit("click",{},!0)}})}function L(e){["left-hand","right-hand"].forEach(t=>{const n=document.getElementById(t);if(!n)return;const s=()=>{const c=n.components.raycaster;if(!c)return;const a=c.intersectedEls;a&&a.length>0&&a[0].emit("click",{},!0)};n.addEventListener("triggerdown",s),n.addEventListener("selectstart",s),n.addEventListener("gripdown",s)}),e.querySelectorAll(".clickable").forEach(t=>{t.addEventListener("mouseenter",()=>{t.setAttribute("material","opacity",1)}),t.addEventListener("mouseleave",()=>{t.setAttribute("material","opacity",.85)})})}function k(){const e=document.getElementById("scene");if(!e)return;const t=()=>{e.is("vr-mode")||!navigator.xr||navigator.xr.isSessionSupported("immersive-vr").then(n=>{n&&e.enterVR&&e.enterVR()}).catch(()=>{})};e.hasLoaded?t():e.addEventListener("loaded",t)}k();m.waitReady().then(()=>{const e=m.profile,t=document.getElementById("scene"),n=()=>{p(e),y(t),L(t)};t.hasLoaded?n():t.addEventListener("loaded",n)});
