import{a as L}from"./auth-manager-Cgi3t6lo.js";import{G as D,W as P}from"./weapon-system-d2_OwAli.js";import{g as N,s as H}from"./game-main-mmDl1NPy.js";import{i as y}from"./iap-manager-BjUsMUVa.js";import"./audio-manager-BRKiiRd-.js";const _={success:{bg:"#00cc66",color:"#fff"},info:{bg:"#0088cc",color:"#fff"},warning:{bg:"#ff8800",color:"#fff"},achievement:{bg:"linear-gradient(135deg, #ffd700, #ff8c00)",color:"#000"},error:{bg:"#ff4444",color:"#fff"}};let E=null;function W(){return E&&document.body.contains(E)||(E=document.createElement("div"),E.className="toast-container",document.body.appendChild(E)),E}function j(e,i="info",s=3e3){const c=W(),t=_[i]||_.info,n=document.createElement("div");n.className="toast toast-enter",n.style.background=t.bg,n.style.color=t.color;const r=document.createElement("span");r.className="toast-text",r.textContent=e,n.appendChild(r);const a=document.createElement("div");a.className="toast-progress",a.style.animationDuration=`${s}ms`,n.appendChild(a),n.addEventListener("click",()=>O(n)),c.appendChild(n),requestAnimationFrame(()=>n.classList.remove("toast-enter"));const u=setTimeout(()=>O(n),s);return n._timer=u,n}function O(e){e._dismissed||(e._dismissed=!0,e._timer&&clearTimeout(e._timer),e.classList.add("toast-exit"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}let C="timeAttack",B="pistol",I="cyber";function h(){["left-hand","right-hand"].forEach(e=>{const i=document.getElementById(e);i&&i.components&&i.components.raycaster&&i.components.raycaster.refreshObjects()})}function w(e){const i=()=>{if(!e.object3D)return;const s=e.getObject3D("mesh");s&&e.object3D.traverse(c=>{c!==s&&c.isMesh&&(c.raycast=()=>{})})};setTimeout(i,100),setTimeout(i,500),setTimeout(i,1500)}function T(e,{x:i,y:s,width:c,height:t,label:n,value:r,selected:a,locked:u}){const o=document.createElement("a-plane");if(o.classList.add("clickable"),o.setAttribute("position",`${i} ${s} 0`),o.setAttribute("width",c),o.setAttribute("height",t),o.setAttribute("color",u?"#1a1a2e":a?"#00d4ff":"#1a1a4e"),o.setAttribute("material","shader: flat; opacity: 0.85"),o.dataset.value=r,a){const d=document.createElement("a-plane");d.setAttribute("position","0 0 -0.01"),d.setAttribute("width",c+.06),d.setAttribute("height",t+.06),d.setAttribute("color","#00d4ff"),d.setAttribute("material","shader: flat; opacity: 0.15"),o.appendChild(d)}o.addEventListener("mouseenter",()=>{o.setAttribute("material","opacity",1),u||o.setAttribute("animation__hover",{property:"scale",to:"1.08 1.08 1.08",dur:120,easing:"easeOutQuad"})}),o.addEventListener("mouseleave",()=>{o.setAttribute("material","opacity",.85),o.setAttribute("animation__hover",{property:"scale",to:"1 1 1",dur:120,easing:"easeOutQuad"})});const l=n,b=document.createElement("a-text");return b.setAttribute("value",l),b.setAttribute("align","center"),b.setAttribute("color",u?"#555566":a?"#ffffff":"#aaaacc"),b.setAttribute("width",c*2.5),b.setAttribute("position","0 0 0.01"),o.appendChild(b),e.appendChild(o),w(o),o}function x(e){const i=document.getElementById("mode-buttons");i.innerHTML="";const s=Object.values(D),c=-(s.length-1)*.85/2;s.forEach((t,n)=>{const r=e.level>=t.unlockLevel,a=r?t.name:`${t.name} (Lv.${t.unlockLevel})`,u=T(i,{x:c+n*.85,y:0,width:.75,height:.3,label:a,value:t.id,selected:t.id===C,locked:!r});r&&u.addEventListener("menuclick",()=>{C=t.id,x(e),h()})})}function $(e){const i=document.getElementById("weapon-buttons");i.innerHTML="";const s=Object.values(P),c=-(s.length-1)*.85/2;s.forEach((t,n)=>{const r=e.level>=t.unlockLevel,a=r?t.name:`${t.name} (Lv.${t.unlockLevel})`,u=T(i,{x:c+n*.85,y:0,width:.75,height:.3,label:a,value:t.id,selected:t.id===B,locked:!r});r&&u.addEventListener("menuclick",()=>{B=t.id,$(e),h()})})}function M(e){const i=document.getElementById("theme-buttons");i.innerHTML="";const s=Object.values(N()),c=s.slice(0,3),t=s.slice(3),n=.85,r=.75,a=.25,u=(o,l)=>{const b=-(o.length-1)*n/2;o.forEach((d,p)=>{const f=e.level>=(d.unlockLevel||1),v=f?d.name:`${d.name} (Lv.${d.unlockLevel})`,A=T(i,{x:b+p*n,y:l,width:r,height:a,label:v,value:d.id,selected:d.id===I,locked:!f});f&&A.addEventListener("menuclick",()=>{I=d.id,M(e),h()})})};u(c,.08),t.length&&u(t,-.22)}function G(){k=!1;const e=document.getElementById("menu-content"),i=document.getElementById("game-content"),s=document.getElementById("shop-content");e.setAttribute("visible","false"),s&&s.setAttribute("visible","false"),i.setAttribute("visible","true"),["crosshair","crosshair-outer","crosshair-dot","hud-score","hud-timer","hud-combo","hud-lives","hud-weapon","hud-level","hud-powerup","game-cursor"].forEach(n=>{const r=document.getElementById(n);r&&r.setAttribute("visible","true")}),["left-hand","right-hand"].forEach(n=>{const r=document.getElementById(n);r&&(r.setAttribute("raycaster","objects",".target"),r.setAttribute("shoot-controls",`hand: ${n==="left-hand"?"left":"right"}`),r.components.cursor&&r.removeAttribute("cursor"))});const c=document.getElementById("camera");c&&c.setAttribute("wasd-controls","acceleration: 20");const t=document.getElementById("player-rig");t&&t.setAttribute("smooth-locomotion","speed: 3; camera: #camera"),H({mode:C,weapon:B,theme:I,onReturnToMenu:R})}function R(){const e=document.getElementById("menu-content"),i=document.getElementById("game-content"),s=document.getElementById("shop-content");i.setAttribute("visible","false"),s&&s.setAttribute("visible","false"),e.setAttribute("visible","true"),["crosshair","crosshair-outer","crosshair-dot","hud-score","hud-timer","hud-combo","hud-lives","hud-weapon","hud-level","hud-powerup","game-cursor"].forEach(r=>{const a=document.getElementById(r);a&&a.setAttribute("visible","false")}),["left-hand","right-hand"].forEach(r=>{const a=document.getElementById(r);a&&(a.setAttribute("raycaster","objects",".clickable"),a.removeAttribute("shoot-controls"),a.setAttribute("cursor","fuse: false; rayOrigin: entity"))});const c=document.getElementById("camera");c&&c.setAttribute("wasd-controls-enabled","false");const t=L.profile;if(t){x(t),$(t),M(t);const r=document.getElementById("player-info");r&&r.setAttribute("value",`Lv.${t.level} | ${t.coins} Coins`)}h();const n=document.getElementById("hud-gameover");n&&n.setAttribute("visible","false")}window.__switchToMenu=R;function V(e){B=e.selectedWeapon||"pistol";const i=document.getElementById("player-info");i&&i.setAttribute("value",`Lv.${e.level} | ${e.coins} Coins`),x(e),$(e),M(e),h();const s=document.getElementById("btn-play-vr");s&&(w(s),s.addEventListener("mouseenter",()=>{s.setAttribute("material","opacity",1)}),s.addEventListener("mouseleave",()=>{s.setAttribute("material","opacity",.9)}),s.addEventListener("menuclick",()=>{G()}));const c=document.getElementById("btn-shop-vr");c&&(w(c),c.addEventListener("mouseenter",()=>{c.setAttribute("material","opacity",1)}),c.addEventListener("mouseleave",()=>{c.setAttribute("material","opacity",.9)}),c.addEventListener("menuclick",()=>F()));const t=document.getElementById("btn-exit-vr");console.log("[Menu] Exit button found:",!!t),t&&(t.addEventListener("mouseenter",()=>{console.log("[Menu] Exit hover"),t.setAttribute("material","opacity",1)}),t.addEventListener("mouseleave",()=>{t.setAttribute("material","opacity",.9)}),t.addEventListener("menuclick",()=>{console.log("[Menu] Exit clicked!");const r=document.getElementById("scene");r&&r.is("vr-mode")&&r.exitVR();try{window.close()}catch{}setTimeout(()=>{window.history.back()},300)}),h());const n=document.getElementById("btn-shop-back");n&&(n.addEventListener("mouseenter",()=>{n.setAttribute("material","opacity",1)}),n.addEventListener("mouseleave",()=>{n.setAttribute("material","opacity",.9)}),n.addEventListener("menuclick",()=>Y())),y.init().catch(()=>{})}function X(e){const i=e.canvas;if(!i)return;const s=new THREE.Raycaster,c=new THREE.Vector2;i.addEventListener("click",t=>{const n=i.getBoundingClientRect();c.x=(t.clientX-n.left)/n.width*2-1,c.y=-((t.clientY-n.top)/n.height)*2+1,s.setFromCamera(c,e.camera);const r=["menu-content","shop-content","game-content"].map(o=>document.getElementById(o)).filter(o=>o&&!o.object3D.visible),a=[];e.querySelectorAll(".clickable").forEach(o=>{!o.object3D||!o.object3D.visible||r.some(l=>l.contains(o))||o.object3D.traverse(l=>{l.isMesh&&(l.__clickEl=o,a.push(l))})});const u=s.intersectObjects(a,!1);if(u.length>0){const o=u[0].object.__clickEl;o&&o.emit("menuclick",{},!1)}})}function q(e){["left-hand","right-hand"].forEach(i=>{const s=document.getElementById(i);s&&(s.addEventListener("click",c=>{const t=s.components.raycaster;if(!t)return;const n=t.intersectedEls;n&&n.length>0&&n[0].emit("menuclick",{},!0)}),s.addEventListener("selectstart",()=>{const c=s.components.raycaster;if(!c)return;const t=c.intersectedEls;t&&t.length>0&&t[0].emit("menuclick",{},!0)}))})}function F(){document.getElementById("menu-content").setAttribute("visible","false"),document.getElementById("shop-content").setAttribute("visible","true"),k=!0,S(),setTimeout(()=>h(),100)}function Y(){k=!1,document.getElementById("shop-content").setAttribute("visible","false"),document.getElementById("menu-content").setAttribute("visible","true");const e=L.profile;if(e){const i=document.getElementById("player-info");i&&i.setAttribute("value",`Lv.${e.level} | ${e.coins} Coins`)}setTimeout(()=>h(),100)}function S(){const e=document.getElementById("shop-cards");e.innerHTML="";const i=y.products,s=-(i.length-1)*1.1/2,c=document.getElementById("shop-balance"),t=L.profile;if(c&&t){const n=t.isPremium?" | Premium":"";c.setAttribute("value",`${t.coins||0} Coins${n}`)}i.forEach((n,r)=>{const a=s+r*1.15,u=n.type==="non_consumable"&&y.isOwned(n.id),o=document.createElement("a-plane");o.setAttribute("position",`${a} 0 -0.02`),o.setAttribute("width","1.06"),o.setAttribute("height","1.36"),o.setAttribute("color",u?"#44ff44":"#00d4ff"),o.setAttribute("material","shader: flat; opacity: 0.06"),e.appendChild(o);const l=document.createElement("a-plane");l.setAttribute("position",`${a} 0 0`),l.setAttribute("width","1.0"),l.setAttribute("height","1.3"),l.setAttribute("color",u?"#1a3a1a":"#1a1a3a"),l.setAttribute("material","shader: flat; opacity: 0.9"),l.addEventListener("mouseenter",()=>{l.setAttribute("material","opacity",1),o.setAttribute("material","opacity",.12)}),l.addEventListener("mouseleave",()=>{l.setAttribute("material","opacity",.9),o.setAttribute("material","opacity",.06)});const b=document.createElement("a-text"),d=n.type==="consumable"?"ğŸª™":"â­";b.setAttribute("value",d),b.setAttribute("position","0 0.42 0.01"),b.setAttribute("align","center"),b.setAttribute("width","3.5"),l.appendChild(b);const p=document.createElement("a-text");p.setAttribute("value",n.name),p.setAttribute("position","0 0.15 0.01"),p.setAttribute("align","center"),p.setAttribute("color","#ffffff"),p.setAttribute("width","2.8"),l.appendChild(p);const f=document.createElement("a-text");f.setAttribute("value",n.description),f.setAttribute("position","0 -0.02 0.01"),f.setAttribute("align","center"),f.setAttribute("color","#888899"),f.setAttribute("width","2"),l.appendChild(f);const v=document.createElement("a-plane");v.setAttribute("position","0 -0.18 0.01"),v.setAttribute("width","0.7"),v.setAttribute("height","0.002"),v.setAttribute("color","#444466"),v.setAttribute("material","shader: flat; opacity: 0.5"),l.appendChild(v);const A=document.createElement("a-text");A.setAttribute("value",y.getDisplayPrice(n)),A.setAttribute("position","0 -0.3 0.01"),A.setAttribute("align","center"),A.setAttribute("color","#ffd700"),A.setAttribute("width","2.8"),l.appendChild(A);const m=document.createElement("a-plane");m.classList.add("clickable"),m.setAttribute("position","0 -0.5 0.02"),m.setAttribute("width","0.75"),m.setAttribute("height","0.22");const g=document.createElement("a-text");g.setAttribute("position","0 0 0.01"),g.setAttribute("align","center"),g.setAttribute("width","3"),u?(m.setAttribute("color","#444444"),m.setAttribute("material","shader: flat; opacity: 0.7"),g.setAttribute("value","âœ“ OWNED"),g.setAttribute("color","#88ff88")):(m.setAttribute("color","#006644"),m.setAttribute("material","shader: flat; opacity: 0.9"),g.setAttribute("value","BUY"),g.setAttribute("color","#00ff88"),m.addEventListener("mouseenter",()=>{m.setAttribute("material","opacity",1)}),m.addEventListener("mouseleave",()=>{m.setAttribute("material","opacity",.9)}),m.addEventListener("menuclick",()=>Q(n))),m.appendChild(g),l.appendChild(m),e.appendChild(l)}),h()}let k=!1;async function Q(e){if(k)try{if((await y.purchase(e.id)).success){const s=e.type==="consumable"?`Purchased! +${e.coinAmount} Coins`:`${e.name} unlocked!`;j(s,"success"),S()}}catch(i){j("Purchase failed","error"),console.warn("[Shop] Purchase error:",i.message)}}L.waitReady().then(()=>{const e=L.profile,i=document.getElementById("scene"),s=()=>{V(e),X(i),q();const c=()=>{i.querySelectorAll(".clickable").forEach(t=>w(t))};setTimeout(c,1e3),setTimeout(c,3e3),navigator.xr&&i.enterVR&&navigator.xr.isSessionSupported("immersive-vr").then(t=>{t&&!i.is("vr-mode")&&i.enterVR()}).catch(()=>{})};i.hasLoaded?s():i.addEventListener("loaded",s)});
