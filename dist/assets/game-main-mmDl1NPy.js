import{a as u,i as rt,d as yt,b as st,s as bt,c as vt,e as _t,q as wt,o as At,l as Ct,g as Et}from"./auth-manager-Cgi3t6lo.js";import{a as _}from"./audio-manager-BRKiiRd-.js";import{p as P,w as H,g as O}from"./weapon-system-d2_OwAli.js";const F=Object.freeze({MENU:"menu",PLAYING:"playing",PAUSED:"paused",GAME_OVER:"game_over"});class St{constructor(){this._state=F.MENU,this._listeners=[]}get state(){return this._state}changeState(t){this._state!==t&&(this._state=t,this._listeners.forEach(e=>e(this._state)))}onStateChange(t){this._listeners.push(t)}}const W=new St;class Mt{constructor(){this._score=0,this._shotsFired=0,this._listeners=[]}get score(){return this._score}reset(){this._score=0,this._shotsFired=0,this._notify()}recordShot(){this._shotsFired++}add(t){this._score+=t,this._notify()}finalize(){return{score:this._score,shotsFired:this._shotsFired}}onChange(t){this._listeners.push(t)}_notify(){this._listeners.forEach(t=>t(this._score))}}const B=new Mt,nt={volume:80,sfx:!0,vibration:50,crosshairSize:"medium",crosshairColor:"#00ff88",highContrast:!1,reducedMotion:!1,autoSubmitScore:!0,showCombo:!0,bloom:!0,screenShake:"medium"};function Y(){try{const o=localStorage.getItem("vr_quest_player_v2");if(o){const t=JSON.parse(o);return{...nt,...t.settings||{}}}}catch{}return{...nt}}const Tt=10,q={x:11,yMin:1,yMax:4,zMin:-12,zMax:-3},lt=["#e94560","#ff6b6b","#ffa502","#2ed573","#1e90ff","#a855f7","#ff69b4"],ct={standard:{metalness:.6,roughness:.3,emissive:"#222222",emissiveIntensity:.4},speed:{metalness:.8,roughness:.2,emissive:"#ffdd00",emissiveIntensity:.6},heavy:{metalness:.9,roughness:.1,emissive:"#ff1111",emissiveIntensity:.5},bonus:{metalness:.7,roughness:.2,emissive:"#ffd700",emissiveIntensity:.8},decoy:{metalness:.5,roughness:.5,emissive:"#440000",emissiveIntensity:.3},powerup:{metalness:.9,roughness:.1,emissive:"#00ffaa",emissiveIntensity:1}},j={standard:{weight:50,points:10,radius:.3,geometry:"a-icosahedron",color:null,hp:1,speed:0,lifetime:null,coins:0},speed:{weight:20,points:25,radius:.22,geometry:"a-octahedron",color:"#ffdd00",hp:1,speed:2.5,lifetime:null,coins:0},heavy:{weight:15,points:30,radius:.4,geometry:"a-dodecahedron",color:"#ff3333",hp:2,speed:0,lifetime:null,coins:0},bonus:{weight:8,points:50,radius:.25,geometry:"a-torus",color:"#ffd700",hp:1,speed:0,lifetime:2e3,coins:5},decoy:{weight:7,points:-10,radius:.3,geometry:"a-sphere",color:"#882222",hp:1,speed:0,lifetime:null,coins:0},powerup:{weight:5,points:10,radius:.35,geometry:"a-torus-knot",color:"#00ffaa",hp:1,speed:1.5,lifetime:3e3,coins:0}};class It{constructor(t,e={}){this._container=t,this._targets=new Set,this._spawnTimer=null,this._running=!1,this._combo=0,this._comboTimer=null,this._onComboChange=null,this._onMiss=null,this._targetsHit=0,this._bestCombo=0,this._spawnInterval=e.spawnInterval||1500,this._maxTargets=e.maxTargets||8,this._targetLifetime=e.targetLifetime||5e3,this._bossMode=e.bossMode||!1,this._wave=0,this._coinsEarned=0,this._slowMoActive=!1,this._slowMoTimeout=null,this._bossWave=0,this._bossWaveKills=0,this._bossSpawnPaused=!1,this._currentBoss=null,this._currentBossHp=0,this._currentBossMaxHp=0}set onComboChange(t){this._onComboChange=t}set onMiss(t){this._onMiss=t}get targetsHit(){return this._targetsHit}get bestCombo(){return this._bestCombo}get coinsEarned(){return this._coinsEarned}configure(t){this._spawnInterval=t.spawnInterval||this._spawnInterval,this._maxTargets=t.maxTargets||this._maxTargets,this._targetLifetime=t.targetLifetime||this._targetLifetime,this._bossMode=t.bossMode||!1,this._wave=0,this._coinsEarned=0}start(){this._running=!0,this._combo=0,this._targetsHit=0,this._bestCombo=0,this._coinsEarned=0,this._wave=0,this._bossWave=0,this._bossWaveKills=0,this._bossSpawnPaused=!1,this._currentBoss=null,this._clearAll(),this._spawnTimer=setInterval(()=>this._trySpawn(),this._spawnInterval);for(let t=0;t<3;t++)this._spawnTarget()}stop(){this._running=!1,this._spawnTimer&&(clearInterval(this._spawnTimer),this._spawnTimer=null),this._slowMoTimeout&&(clearTimeout(this._slowMoTimeout),this._slowMoTimeout=null,this._slowMoActive=!1),this._clearAll()}_trySpawn(){!this._running||this._bossSpawnPaused||this._targets.size>=this._maxTargets||this._spawnTarget()}_pickTargetType(){if(this._bossMode)return"heavy";let t=0;for(const a of Object.values(j))t+=a.weight;let e=Math.random()*t;for(const[a,r]of Object.entries(j))if(e-=r.weight,e<=0)return a;return"standard"}_spawnTarget(){const t=this._pickTargetType(),e=j[t],r={"a-torus-knot":"torusKnot"}[e.geometry]||e.geometry.replace("a-",""),i=document.createElement("a-entity");i.setAttribute("class","target");let s=`primitive: ${r}`;e.geometry==="a-torus"?s+=`; radius: ${e.radius}; radiusTubular: 0.06; segmentsRadial: 8; segmentsTubular: 24`:e.geometry==="a-torus-knot"?s+=`; radius: ${e.radius*.6}; radiusTubular: 0.04`:s+=`; radius: ${e.radius}`,i.setAttribute("geometry",s),e.geometry!=="a-sphere"&&i.setAttribute("animation__rotate",{property:"rotation",to:"360 360 0",dur:4e3+Math.random()*2e3,easing:"linear",loop:!0});const n=e.color||this._randomColor(),l=ct[t]||ct.standard;if(i.setAttribute("material",`color: ${n}; metalness: ${l.metalness}; roughness: ${l.roughness}; emissive: ${l.emissive}; emissiveIntensity: ${l.emissiveIntensity}`),i.setAttribute("shadow","cast: true; receive: false"),t!=="decoy"){const d=document.createElement(e.geometry==="a-torus"?"a-torus":e.geometry==="a-torus-knot"?"a-torus-knot":"a-sphere"),g=e.radius*1.05;e.geometry==="a-torus"?(d.setAttribute("radius",String(e.radius*1.05)),d.setAttribute("radius-tubular","0.065"),d.setAttribute("segments-radial","8"),d.setAttribute("segments-tubular","24")):e.geometry==="a-torus-knot"?(d.setAttribute("radius",String(e.radius*.65)),d.setAttribute("radius-tubular","0.05")):d.setAttribute("radius",String(g)),d.setAttribute("material",`color: ${n}; wireframe: true; opacity: 0.15; transparent: true`),i.appendChild(d)}else{const d=document.createElement("a-sphere");d.setAttribute("radius",String(e.radius*1.08)),d.setAttribute("material","color: #ff0000; wireframe: true; opacity: 0.2; transparent: true"),i.appendChild(d)}const p=this._bossMode?e.hp+Math.floor(this._wave/3):e.hp;if(i.setAttribute("target-hit",`hp: ${p}; targetType: ${t}`),this._bossMode){const d=Math.min(1+this._bossWave*.05,2);i.setAttribute("scale",`${d} ${d} ${d}`);let g="#ff3333",S="#ff1111";this._bossWave>=16?(g="#ffd700",S="#ffaa00"):this._bossWave>=11?(g="#aa00ff",S="#7700cc"):this._bossWave>=6&&(g="#ff6600",S="#cc4400"),i.setAttribute("material",`color: ${g}; metalness: 0.9; roughness: 0.1; emissive: ${S}; emissiveIntensity: 0.6`);const A=document.createElement("a-torus");A.setAttribute("radius",String(e.radius*1.6)),A.setAttribute("radius-tubular","0.02"),A.setAttribute("material",`color: ${g}; emissive: ${S}; emissiveIntensity: 0.8; opacity: 0.4`),A.setAttribute("animation__spin",{property:"rotation",to:"0 360 0",dur:2e3,easing:"linear",loop:!0}),i.appendChild(A);const C=document.createElement("a-torus");C.setAttribute("radius",String(e.radius*1.4)),C.setAttribute("radius-tubular","0.015"),C.setAttribute("rotation","90 0 0"),C.setAttribute("material",`color: ${g}; emissive: ${S}; emissiveIntensity: 0.6; opacity: 0.3`),C.setAttribute("animation__spin",{property:"rotation",from:"90 0 0",to:"90 0 360",dur:3e3,easing:"linear",loop:!0}),i.appendChild(C),i.setAttribute("animation__glow",{property:"material.emissiveIntensity",from:.3,to:.8,dur:800,loop:!0,dir:"alternate",easing:"easeInOutSine"}),this._currentBoss=i,this._currentBossHp=p,this._currentBossMaxHp=p,_.playBossSpawn(),document.dispatchEvent(new CustomEvent("boss-spawn",{detail:{hp:p,maxHp:p,wave:this._bossWave}}))}const f=this._rand(-11,q.x),m=this._rand(q.yMin,q.yMax),b=this._rand(q.zMin,q.zMax);if(i.setAttribute("position",`${f} ${m} ${b}`),i.setAttribute("animation__spawn",{property:"scale",from:"0 0 0",to:"1 1 1",dur:300,easing:"easeOutElastic"}),!Y().reducedMotion)if(e.speed>0){const d=e.speed;i.setAttribute("animation__move",{property:"position",to:`${f+d} ${m} ${b}`,dur:800+Math.random()*400,easing:"easeInOutSine",loop:!0,dir:"alternate"})}else i.setAttribute("animation__float",{property:"position",to:`${f} ${m+.3} ${b}`,dur:1200+Math.random()*600,easing:"easeInOutSine",loop:!0,dir:"alternate"});t==="powerup"&&(i.setAttribute("animation__rotate",{property:"rotation",to:"360 360 0",dur:2e3,easing:"linear",loop:!0}),i.setAttribute("animation__glow",{property:"material.emissiveIntensity",from:.5,to:1.2,dur:600,loop:!0,dir:"alternate",easing:"easeInOutSine"})),i._targetType=t,i._targetPoints=e.points,i._targetCoins=e.coins,i.addEventListener("destroyed",d=>{var A,C;const g=((A=d==null?void 0:d.detail)==null?void 0:A.damage)||1,S=((C=d==null?void 0:d.detail)==null?void 0:C.position)||null;this._onTargetHit(i,g,S)});const h=e.lifetime||this._targetLifetime,T=setTimeout(()=>{this._targets.has(i)&&this._removeTarget(i,!0)},h);i._expireTimeout=T,this._container.appendChild(i),this._targets.add(i),_.playSpawn()}_onTargetHit(t,e=1,a=null){var n,l,p,f,m,b;if(!this._running)return;const r=t._targetPoints!==void 0?t._targetPoints:Tt,i=t._targetType==="decoy",s=a||{x:0,y:2,z:-5};if(i)B.add(r),this._combo=0,(n=this._onComboChange)==null||n.call(this,0),_.playMiss(),this._spawnDamageNumber(s,r,"#ff4444",""),this._flashScreen("miss");else{this._combo++,this._targetsHit++,this._wave++,this._combo>this._bestCombo&&(this._bestCombo=this._combo),this._comboTimer&&clearTimeout(this._comboTimer),this._comboTimer=setTimeout(()=>{var A;this._combo=0,(A=this._onComboChange)==null||A.call(this,0)},2e3);const w=Math.min(this._combo,5),h=P.getMultiplier(),T=r*w*e*h;if(B.add(T),(l=this._onComboChange)==null||l.call(this,this._combo),_.playHit(),(p=window.__hapticManager)==null||p.hit(),this._combo>=2&&(_.playCombo(this._combo),(f=window.__hapticManager)==null||f.combo(this._combo)),this._combo>=10&&this._triggerSlowMotion(),t._targetType==="powerup"){const A=P.activateRandom();this._spawnDamageNumber(s,0,A.config.color,A.config.label),(m=window.__hapticManager)==null||m.powerUp()}const d=w>1?` x${w}`:"",g=h>1?" 2X":"",S=t._targetType==="bonus"?"#ffd700":t._targetType==="powerup"?"#00ffaa":w>1?"#00d4ff":"#ffffff";if(this._spawnDamageNumber(s,T,S,d+g),this._flashScreen("hit"),t._targetCoins>0){this._coinsEarned+=t._targetCoins;const A=u.profile;A&&u.saveProfile({coins:(A.coins||0)+t._targetCoins})}this._bossMode&&(t===this._currentBoss&&(_.playBossKill(),(b=window.__hapticManager)==null||b.bossKill(),this._currentBoss=null,document.dispatchEvent(new CustomEvent("boss-killed"))),this._bossWaveKills++,this._bossWaveKills>=5&&(this._bossWaveKills=0,this._bossWave++,_.playWaveClear(),document.dispatchEvent(new CustomEvent("boss-wave-clear",{detail:{wave:this._bossWave}})),this._bossSpawnPaused=!0,setTimeout(()=>{this._bossSpawnPaused=!1},1500)))}this._targets.delete(t),t._expireTimeout&&clearTimeout(t._expireTimeout)}_triggerSlowMotion(){var e;if(this._slowMoActive)return;this._slowMoActive=!0;const t=[];this._targets.forEach(a=>{["animation__move","animation__float","animation__rotate"].forEach(r=>{const i=a.getAttribute(r);if(i&&i.dur){const s=i.dur;t.push({el:a,name:r,origDur:s}),a.setAttribute(r,"dur",s*3)}})}),_.playSlowMoHit(),(e=window.__hapticManager)==null||e.slowMo(),document.dispatchEvent(new CustomEvent("slow-motion",{detail:{active:!0}})),this._slowMoTimeout=setTimeout(()=>{this._slowMoActive=!1,t.forEach(({el:a,name:r,origDur:i})=>{a.parentNode&&a.setAttribute(r,"dur",i)}),document.dispatchEvent(new CustomEvent("slow-motion",{detail:{active:!1}}))},300)}_spawnDamageNumber(t,e,a,r){const i=this._container.sceneEl||this._container.closest("a-scene");if(!i)return;const s=e>=0?`+${e}${r}`:`${e}`,n=document.createElement("a-entity");n.setAttribute("position",`${t.x} ${t.y+.3} ${t.z}`),n.setAttribute("damage-number",`text: ${s}; color: ${a}`),i.appendChild(n)}_flashScreen(t){let e=document.getElementById("hit-flash");e||(e=document.createElement("div"),e.id="hit-flash",e.className="hit-flash",document.body.appendChild(e)),e.className="hit-flash",e.offsetWidth,e.classList.add(t==="miss"?"flash-miss":"flash-hit"),setTimeout(()=>e.classList.remove("flash-hit","flash-miss"),100)}_removeTarget(t,e=!1){var a,r;this._targets.delete(t),t._expireTimeout&&clearTimeout(t._expireTimeout),e?(this._combo=0,(a=this._onComboChange)==null||a.call(this,0),_.playMiss(),(r=this._onMiss)==null||r.call(this),t.setAttribute("animation__fade",{property:"material.opacity",to:0,dur:200}),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},250)):t.parentNode&&t.parentNode.removeChild(t)}_clearAll(){this._targets.forEach(t=>{t._expireTimeout&&clearTimeout(t._expireTimeout),t.parentNode&&t.parentNode.removeChild(t)}),this._targets.clear()}_randomColor(){return lt[Math.floor(Math.random()*lt.length)]}_rand(t,e){return Math.random()*(e-t)+t}}const dt="vr_quest_leaderboard_cache",$t=20;class kt{constructor(){this._cache=this._loadCache()}async submitScore(t,e){var i;if(!rt||!u.user)return;const a=u.uid,r=yt(st,"leaderboards",t,"scores",a);await bt(r,{uid:a,displayName:u.displayName,score:e,level:((i=u.profile)==null?void 0:i.level)||1,timestamp:vt()},{merge:!0})}async getTopScores(t,e=$t){if(!rt)return this._cache[t]||[];try{const a=_t(st,"leaderboards",t,"scores"),r=wt(a,At("score","desc"),Ct(e)),i=await Et(r),s=[];return i.forEach(n=>s.push({id:n.id,...n.data()})),this._cache[t]=s,this._saveCache(),s}catch{return this._cache[t]||[]}}_loadCache(){try{const t=localStorage.getItem(dt);return t?JSON.parse(t):{}}catch{return{}}}_saveCache(){try{localStorage.setItem(dt,JSON.stringify(this._cache))}catch{}}}const Gt=new kt,mt=[{id:"score500_ta",description:"Score 500+ in Time Attack",type:"score",mode:"timeAttack",target:500,rewardXp:100,rewardCoins:20},{id:"hit50",description:"Hit 50 targets in one session",type:"targetsHit",target:50,rewardXp:75,rewardCoins:15},{id:"combo5",description:"Get a x5 combo",type:"combo",target:5,rewardXp:80,rewardCoins:15},{id:"play3",description:"Play 3 games today",type:"gamesPlayed",target:3,rewardXp:50,rewardCoins:10},{id:"score200_sniper",description:"Score 200+ with Sniper",type:"scoreWeapon",weapon:"sniper",target:200,rewardXp:120,rewardCoins:25},{id:"survive300",description:"Score 300+ in Survival",type:"score",mode:"survival",target:300,rewardXp:150,rewardCoins:30},{id:"hit100_total",description:"Hit 100 targets today",type:"totalHitsToday",target:100,rewardXp:100,rewardCoins:20},{id:"combo8",description:"Get a x8 combo",type:"combo",target:8,rewardXp:120,rewardCoins:25},{id:"play5",description:"Play 5 games today",type:"gamesPlayed",target:5,rewardXp:80,rewardCoins:15},{id:"score1000_ta",description:"Score 1000+ in Time Attack",type:"score",mode:"timeAttack",target:1e3,rewardXp:200,rewardCoins:50}];function xt(){const o=new Date;return`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`}function Ot(){const o=new Date;return(o.getFullYear()*1e4+(o.getMonth()+1)*100+o.getDate())%mt.length}function ht(){return mt[Ot()]}function Lt(){const o=u.profile,t=o==null?void 0:o.dailyChallenge,e=xt();return t&&t.date===e?t:{id:ht().id,date:e,progress:0,completed:!1,hitsToday:0,gamesPlayedToday:0}}async function Rt(o){const t=ht(),e=Lt();if(e.completed)return{challenge:t,state:e,justCompleted:!1};e.hitsToday=(e.hitsToday||0)+(o.targetsHit||0),e.gamesPlayedToday=(e.gamesPlayedToday||0)+1;let a=0;switch(t.type){case"score":a=!t.mode||o.mode===t.mode?o.score:0,e.progress=Math.max(e.progress,a);break;case"scoreWeapon":a=o.weapon===t.weapon?o.score:0,e.progress=Math.max(e.progress,a);break;case"targetsHit":a=o.targetsHit||0,e.progress=Math.max(e.progress,a);break;case"combo":a=o.bestCombo||0,e.progress=Math.max(e.progress,a);break;case"gamesPlayed":e.progress=e.gamesPlayedToday;break;case"totalHitsToday":e.progress=e.hitsToday;break}const r=!e.completed&&e.progress>=t.target;if(r){e.completed=!0,await u.addXp(t.rewardXp);const i=u.profile;await u.saveProfile({coins:(i.coins||0)+t.rewardCoins})}return await u.saveProfile({dailyChallenge:e}),{challenge:t,state:e,justCompleted:r}}const Pt=[{id:"first_blood",name:"First Blood",description:"Hit your first target",icon:"ðŸŽ¯",rewardXp:10,check:o=>o.totalTargetsHit>=1},{id:"sharpshooter",name:"Sharpshooter",description:"Get a x10 combo",icon:"ðŸ”¥",rewardXp:50,check:o=>o.bestCombo>=10},{id:"centurion",name:"Centurion",description:"Hit 100 total targets",icon:"ðŸ’¯",rewardXp:25,check:o=>o.totalTargetsHit>=100},{id:"marksman",name:"Marksman",description:"Score 1000 in Time Attack",icon:"ðŸ†",rewardXp:50,check:o=>{var t;return(((t=o.highScores)==null?void 0:t.timeAttack)||0)>=1e3}},{id:"survivor",name:"Survivor",description:"Score 500 in Survival",icon:"â¤ï¸",rewardXp:50,check:o=>{var t;return(((t=o.highScores)==null?void 0:t.survival)||0)>=500}},{id:"zen_master",name:"Zen Master",description:"Play 10 games",icon:"ðŸ§˜",rewardXp:30,check:o=>o.gamesPlayed>=10},{id:"arsenal",name:"Arsenal",description:"Reach level 5 (unlock all weapons)",icon:"ðŸ”«",rewardXp:100,check:o=>o.level>=5},{id:"veteran",name:"Veteran",description:"Play 50 games",icon:"â­",rewardXp:75,check:o=>o.gamesPlayed>=50},{id:"level10",name:"Level 10",description:"Reach level 10",icon:"ðŸ‘‘",rewardXp:100,check:o=>o.level>=10},{id:"boss_slayer",name:"Boss Slayer",description:"Score 300 in Boss Rush",icon:"ðŸ‘¹",rewardXp:100,check:o=>{var t;return(((t=o.highScores)==null?void 0:t.bossRush)||0)>=300}},{id:"combo_king",name:"Combo King",description:"Get a x15 combo",icon:"âš¡",rewardXp:75,check:o=>o.bestCombo>=15},{id:"five_hundred",name:"Five Hundred",description:"Hit 500 total targets",icon:"ðŸŽ–ï¸",rewardXp:50,check:o=>o.totalTargetsHit>=500},{id:"thousand",name:"Thousand",description:"Hit 1000 total targets",icon:"ðŸ…",rewardXp:100,check:o=>o.totalTargetsHit>=1e3},{id:"level20",name:"Legend",description:"Reach level 20",icon:"ðŸ’Ž",rewardXp:200,check:o=>o.level>=20},{id:"dedicated",name:"Dedicated",description:"Play 100 games",icon:"ðŸŽ®",rewardXp:100,check:o=>o.gamesPlayed>=100}];async function Bt(){const o=u.profile;if(!o)return[];const t=o.achievements||[],e=[];for(const a of Pt)t.includes(a.id)||a.check(o)&&(e.push(a),t.push(a.id));if(e.length>0){await u.saveProfile({achievements:t});let a=0;for(const r of e)a+=r.rewardXp;a>0&&await u.addXp(a)}return e}const J={cyber:{id:"cyber",name:"Cyber Arena",icon:"ðŸ’Ž",unlockLevel:1,sky:"#0a0a1a",floor:"#111133",grid:"#1a1a4e",gridOpacity:.3,lights:[{type:"ambient",color:"#222244",intensity:.4},{type:"point",position:"0 10 0",color:"#4466ff",intensity:1.2,distance:40},{type:"point",position:"-8 6 -8",color:"#ff4444",intensity:.6,distance:25},{type:"point",position:"8 6 -8",color:"#44ff44",intensity:.6,distance:25},{type:"point",position:"0 4 8",color:"#ff88ff",intensity:.4,distance:20}],shadowLight:{color:"#4466ff",intensity:.6,position:"5 12 5"},pillarColor:"#1a1a4e",barrierColor:"#0044aa",floorRingColor1:"#00d4ff",floorRingColor2:"#ff44aa",pillarGlowColor:"#00d4ff",baseGlowColor:"#0088ff",cornerGlowColor:"#0088ff",skyGradient:{bottom:"#0a0a2e",mid:"#0a0a1a",top:"#050520"},floorFadeColor:"#0a0a1a",platformSlabColor:"#0a0a22",edgeGlowColor:"#0088ff",underGlowColor:"#0088ff",underGlowRing1:"#0088ff",underGlowRing2:"#00d4ff",belowEnv:[{tag:"a-plane",position:"0 -50 0",rotation:"-90 0 0",width:"200",height:"200",material:"color: #0a0a2e; wireframe: true; opacity: 0.06; shader: flat","segments-width":"40","segments-height":"40"},{tag:"a-plane",position:"-5 -15 -8",width:"0.03",height:"20",material:"shader: flat; color: #4466ff; emissive: #4466ff; emissiveIntensity: 1; opacity: 0.08",animation:"property: position; from: -5 -15 -8; to: -5 -25 -8; dur: 4000; loop: true; easing: linear"},{tag:"a-plane",position:"8 -12 -5",width:"0.03",height:"15",material:"shader: flat; color: #00d4ff; emissive: #00d4ff; emissiveIntensity: 1; opacity: 0.06",animation:"property: position; from: 8 -12 -5; to: 8 -22 -5; dur: 5000; loop: true; easing: linear"},{tag:"a-plane",position:"-10 -18 3",width:"0.03",height:"18",material:"shader: flat; color: #4466ff; emissive: #4466ff; emissiveIntensity: 1; opacity: 0.07",animation:"property: position; from: -10 -18 3; to: -10 -28 3; dur: 3500; loop: true; easing: linear"},{tag:"a-plane",position:"3 -10 6",width:"0.02",height:"12",material:"shader: flat; color: #00d4ff; emissive: #00d4ff; emissiveIntensity: 1; opacity: 0.05",animation:"property: position; from: 3 -10 6; to: 3 -20 6; dur: 4500; loop: true; easing: linear"}],distantEnv:[{tag:"a-box",position:"-20 5 -40",width:"4",height:"10",depth:"4",material:"color: #0a0a2e; metalness: 0.9; roughness: 0.2; emissive: #112244; emissiveIntensity: 0.3"},{tag:"a-box",position:"-12 8 -45",width:"3",height:"16",depth:"3",material:"color: #0a0a2e; metalness: 0.9; roughness: 0.2; emissive: #112244; emissiveIntensity: 0.3"},{tag:"a-box",position:"0 6 -42",width:"5",height:"12",depth:"5",material:"color: #0a0a2e; metalness: 0.9; roughness: 0.2; emissive: #0a1133; emissiveIntensity: 0.3"},{tag:"a-box",position:"14 9 -48",width:"3.5",height:"18",depth:"3.5",material:"color: #0a0a2e; metalness: 0.9; roughness: 0.2; emissive: #112244; emissiveIntensity: 0.3"},{tag:"a-box",position:"22 4 -38",width:"3",height:"8",depth:"3",material:"color: #0a0a2e; metalness: 0.9; roughness: 0.2; emissive: #0a1133; emissiveIntensity: 0.2"},{tag:"a-plane",position:"-20 6 -37.9",width:"3",height:"0.08",material:"shader: flat; color: #4466ff; emissive: #4466ff; emissiveIntensity: 1; opacity: 0.5",animation:"property: material.opacity; from: 0.3; to: 0.6; dur: 2000; loop: true; dir: alternate"},{tag:"a-plane",position:"-12 10 -43.4",width:"2",height:"0.08",material:"shader: flat; color: #00d4ff; emissive: #00d4ff; emissiveIntensity: 1; opacity: 0.5",animation:"property: material.opacity; from: 0.3; to: 0.7; dur: 2500; loop: true; dir: alternate"},{tag:"a-plane",position:"14 12 -46.2",width:"2.5",height:"0.08",material:"shader: flat; color: #4466ff; emissive: #4466ff; emissiveIntensity: 1; opacity: 0.6",animation:"property: material.opacity; from: 0.4; to: 0.7; dur: 1800; loop: true; dir: alternate"},{tag:"a-box",position:"-38 7 -10",width:"4",height:"14",depth:"4",material:"color: #0a0a2e; metalness: 0.9; roughness: 0.2; emissive: #112244; emissiveIntensity: 0.2"},{tag:"a-box",position:"-42 5 -5",width:"3",height:"10",depth:"3",material:"color: #0a0a2e; metalness: 0.9; roughness: 0.2; emissive: #0a1133; emissiveIntensity: 0.2"},{tag:"a-box",position:"38 6 -8",width:"3.5",height:"12",depth:"3.5",material:"color: #0a0a2e; metalness: 0.9; roughness: 0.2; emissive: #112244; emissiveIntensity: 0.2"},{tag:"a-box",position:"44 4  0",width:"3",height:"8",depth:"3",material:"color: #0a0a2e; metalness: 0.9; roughness: 0.2; emissive: #0a1133; emissiveIntensity: 0.2"},{tag:"a-plane",position:"0 0.02 -35",rotation:"-90 0 0",width:"80",height:"0.06",material:"shader: flat; color: #4466ff; emissive: #4466ff; emissiveIntensity: 1; opacity: 0.15"}],decorations:[]},sunset:{id:"sunset",name:"Sunset Range",icon:"ðŸŒ…",unlockLevel:3,sky:"#1a0a05",floor:"#2a1a0a",grid:"#3a2a1a",gridOpacity:.2,lights:[{type:"ambient",color:"#442211",intensity:.5},{type:"point",position:"0 10 0",color:"#ff8844",intensity:1,distance:40},{type:"point",position:"-8 6 -8",color:"#ff6622",intensity:.5,distance:25},{type:"point",position:"8 6 -8",color:"#ffaa44",intensity:.5,distance:25},{type:"point",position:"0 4 8",color:"#ff4400",intensity:.3,distance:20}],shadowLight:{color:"#ff8844",intensity:.5,position:"5 12 5"},pillarColor:"#3a2211",barrierColor:"#663311",floorRingColor1:"#ff6600",floorRingColor2:"#ff2200",pillarGlowColor:"#ff8844",baseGlowColor:"#ff6600",cornerGlowColor:"#ff6600",skyGradient:{bottom:"#ff4400",mid:"#661100",top:"#1a0a05"},floorFadeColor:"#1a0a05",platformSlabColor:"#2a1508",edgeGlowColor:"#ff6600",underGlowColor:"#ff4400",underGlowRing1:"#ff6600",underGlowRing2:"#ff8844",belowEnv:[{tag:"a-plane",position:"-8 -6 -5",rotation:"-90 0 0",width:"20",height:"15",material:"shader: flat; color: #ffccaa; opacity: 0.12; transparent: true"},{tag:"a-plane",position:"10 -8 5",rotation:"-90 0 0",width:"25",height:"18",material:"shader: flat; color: #ff8855; opacity: 0.08; transparent: true"},{tag:"a-plane",position:"0 -10 -10",rotation:"-90 0 0",width:"30",height:"20",material:"shader: flat; color: #ffaa77; opacity: 0.06; transparent: true"},{tag:"a-plane",position:"0 -40 0",rotation:"-90 0 0",width:"200",height:"200",material:"shader: flat; color: #1a0800; opacity: 0.15"}],distantEnv:[{tag:"a-sphere",position:"0 4 -55",radius:"8",material:"shader: flat; color: #ff6600; emissive: #ff6600; emissiveIntensity: 1; opacity: 0.3"},{tag:"a-sphere",position:"0 4 -55",radius:"10",material:"shader: flat; color: #ff4400; opacity: 0.08"},{tag:"a-cone",position:"-25 3 -50","radius-bottom":"12","radius-top":"0",height:"10",material:"shader: flat; color: #1a0800; opacity: 0.7"},{tag:"a-cone",position:"-8 4 -48","radius-bottom":"10","radius-top":"0",height:"12",material:"shader: flat; color: #1a0800; opacity: 0.6"},{tag:"a-cone",position:"10 3.5 -52","radius-bottom":"14","radius-top":"0",height:"11",material:"shader: flat; color: #1a0800; opacity: 0.65"},{tag:"a-cone",position:"28 2.5 -46","radius-bottom":"10","radius-top":"0",height:"8",material:"shader: flat; color: #1a0800; opacity: 0.7"},{tag:"a-cone",position:"-40 3 -20","radius-bottom":"10","radius-top":"0",height:"9",material:"shader: flat; color: #1a0800; opacity: 0.5"},{tag:"a-cone",position:"42 2.5 -15","radius-bottom":"8","radius-top":"0",height:"7",material:"shader: flat; color: #1a0800; opacity: 0.5"},{tag:"a-torus",position:"0 0.5 -10",rotation:"-90 0 0",radius:"6","radius-tubular":"0.05",material:"color: #ff6600; emissive: #ff6600; emissiveIntensity: 0.4; opacity: 0.08",animation:"property: rotation; from: -90 0 0; to: -90 0 360; dur: 25000; easing: linear; loop: true"}],decorations:[]},space:{id:"space",name:"Deep Space",icon:"ðŸŒŒ",unlockLevel:6,sky:"#010105",floor:"#060610",grid:"#0a0a22",gridOpacity:.1,lights:[{type:"ambient",color:"#0a0a18",intensity:.25},{type:"point",position:"0 10 0",color:"#2244ff",intensity:.8,distance:40},{type:"point",position:"-8 6 -8",color:"#4488ff",intensity:.4,distance:25},{type:"point",position:"8 6 -8",color:"#2266cc",intensity:.4,distance:25},{type:"point",position:"0 4 8",color:"#6644ff",intensity:.3,distance:20}],shadowLight:{color:"#2244ff",intensity:.4,position:"5 12 5"},pillarColor:"#080820",barrierColor:"#0a1133",floorRingColor1:"#2244ff",floorRingColor2:"#6644ff",pillarGlowColor:"#4488ff",baseGlowColor:"#2244ff",cornerGlowColor:"#2244ff",skyGradient:{bottom:"#050515",mid:"#010105",top:"#010105"},floorFadeColor:"#010105",platformSlabColor:"#040412",edgeGlowColor:"#2244ff",underGlowColor:"#2244ff",underGlowRing1:"#2244ff",underGlowRing2:"#6644ff",belowEnv:[{tag:"a-sphere",position:"-8 -15 -5",radius:"0.04",material:"shader: flat; color: #ffffff; opacity: 0.4",animation:"property: material.opacity; from: 0.2; to: 0.5; dur: 2000; loop: true; dir: alternate"},{tag:"a-sphere",position:"12 -20 3",radius:"0.05",material:"shader: flat; color: #aaccff; opacity: 0.35",animation:"property: material.opacity; from: 0.15; to: 0.45; dur: 2400; loop: true; dir: alternate"},{tag:"a-sphere",position:"-3 -25 8",radius:"0.06",material:"shader: flat; color: #ffffff; opacity: 0.3",animation:"property: material.opacity; from: 0.1; to: 0.4; dur: 1800; loop: true; dir: alternate"},{tag:"a-sphere",position:"6 -12 -10",radius:"0.03",material:"shader: flat; color: #ffddaa; opacity: 0.35",animation:"property: material.opacity; from: 0.15; to: 0.45; dur: 2200; loop: true; dir: alternate"},{tag:"a-sphere",position:"-15 -18 0",radius:"0.05",material:"shader: flat; color: #ffffff; opacity: 0.25",animation:"property: material.opacity; from: 0.1; to: 0.35; dur: 2600; loop: true; dir: alternate"},{tag:"a-sphere",position:"10 -30 -8",radius:"0.07",material:"shader: flat; color: #8888ff; opacity: 0.2",animation:"property: material.opacity; from: 0.1; to: 0.3; dur: 3000; loop: true; dir: alternate"},{tag:"a-sphere",position:"0 -35 0",radius:"8",material:"shader: flat; color: #221144; opacity: 0.04"},{tag:"a-sphere",position:"-12 -40 -10",radius:"6",material:"shader: flat; color: #441122; opacity: 0.03"}],distantEnv:[{tag:"a-sphere",position:"25 18 -50",radius:"8",material:"color: #334488; metalness: 0.3; roughness: 0.7; emissive: #112244; emissiveIntensity: 0.3"},{tag:"a-torus",position:"25 18 -50",rotation:"20 0 10",radius:"10","radius-tubular":"0.2",material:"color: #556699; emissive: #334466; emissiveIntensity: 0.3; opacity: 0.25",animation:"property: rotation; from: 20 0 10; to: 20 360 10; dur: 60000; easing: linear; loop: true"},{tag:"a-sphere",position:"25 18 -50",radius:"9",material:"shader: flat; color: #2244aa; opacity: 0.04"},{tag:"a-sphere",position:"-20 12 -40",radius:"2.5",material:"color: #aaaacc; metalness: 0.2; roughness: 0.8; emissive: #333344; emissiveIntensity: 0.2"},{tag:"a-icosahedron",position:"-10 8 -30",radius:"0.5",material:"color: #444455; metalness: 0.6; roughness: 0.5",animation:"property: rotation; to: 360 180 90; dur: 8000; easing: linear; loop: true"},{tag:"a-icosahedron",position:"12 10 -35",radius:"0.4",material:"color: #555566; metalness: 0.7; roughness: 0.4",animation:"property: rotation; to: 180 360 0; dur: 10000; easing: linear; loop: true"},{tag:"a-icosahedron",position:"-30 14 -42",radius:"0.7",material:"color: #3a3a4a; metalness: 0.5; roughness: 0.6",animation:"property: rotation; to: 90 270 360; dur: 12000; easing: linear; loop: true"},{tag:"a-torus",position:"-15 8 -35",radius:"2.5","radius-tubular":"0.08",material:"color: #334466; metalness: 0.9; roughness: 0.1; emissive: #112244; emissiveIntensity: 0.3",animation:"property: rotation; to: 360 0 0; dur: 15000; easing: linear; loop: true"},{tag:"a-torus",position:"-15 8 -35",radius:"3","radius-tubular":"0.04",material:"color: #4466aa; emissive: #4466aa; emissiveIntensity: 0.5; opacity: 0.2",animation:"property: rotation; to: 0 360 0; dur: 20000; easing: linear; loop: true"},{tag:"a-sphere",position:"-25 10 -45",radius:"6",material:"shader: flat; color: #4422aa; opacity: 0.04"},{tag:"a-sphere",position:"18 15 -50",radius:"8",material:"shader: flat; color: #aa2266; opacity: 0.03"},{tag:"a-sphere",position:"0 20 -55",radius:"10",material:"shader: flat; color: #2244aa; opacity: 0.035"},{tag:"a-sphere",position:"-12 10 -30",radius:"0.05",material:"shader: flat; color: #ffffff; opacity: 0.5",animation:"property: material.opacity; from: 0.2; to: 0.6; dur: 1500; loop: true; dir: alternate"},{tag:"a-sphere",position:"14 13 -28",radius:"0.04",material:"shader: flat; color: #aaccff; opacity: 0.4",animation:"property: material.opacity; from: 0.15; to: 0.5; dur: 1800; loop: true; dir: alternate"},{tag:"a-sphere",position:"-8 16 -35",radius:"0.06",material:"shader: flat; color: #ffffff; opacity: 0.45",animation:"property: material.opacity; from: 0.2; to: 0.6; dur: 2200; loop: true; dir: alternate"},{tag:"a-sphere",position:"10 14 -38",radius:"0.035",material:"shader: flat; color: #ffddaa; opacity: 0.35",animation:"property: material.opacity; from: 0.1; to: 0.5; dur: 2500; loop: true; dir: alternate"},{tag:"a-sphere",position:"-18 18 -42",radius:"0.05",material:"shader: flat; color: #ffffff; opacity: 0.3",animation:"property: material.opacity; from: 0.15; to: 0.45; dur: 2000; loop: true; dir: alternate"},{tag:"a-sphere",position:"6 20 -48",radius:"0.07",material:"shader: flat; color: #aaaaff; opacity: 0.25",animation:"property: material.opacity; from: 0.1; to: 0.4; dur: 3000; loop: true; dir: alternate"},{tag:"a-sphere",position:"-5 11 -26",radius:"0.03",material:"shader: flat; color: #ffffff; opacity: 0.5",animation:"property: material.opacity; from: 0.25; to: 0.6; dur: 1600; loop: true; dir: alternate"},{tag:"a-sphere",position:"20 16 -40",radius:"0.04",material:"shader: flat; color: #ffccff; opacity: 0.35",animation:"property: material.opacity; from: 0.15; to: 0.5; dur: 2100; loop: true; dir: alternate"},{tag:"a-sphere",position:"-22 13 -32",radius:"0.045",material:"shader: flat; color: #ffffff; opacity: 0.4",animation:"property: material.opacity; from: 0.2; to: 0.55; dur: 1700; loop: true; dir: alternate"},{tag:"a-sphere",position:"0 22 -52",radius:"0.08",material:"shader: flat; color: #88aaff; opacity: 0.2",animation:"property: material.opacity; from: 0.1; to: 0.35; dur: 2800; loop: true; dir: alternate"},{tag:"a-sphere",position:"22 9 -25",radius:"0.03",material:"shader: flat; color: #ffffff; opacity: 0.45",animation:"property: material.opacity; from: 0.2; to: 0.55; dur: 1400; loop: true; dir: alternate"},{tag:"a-sphere",position:"-28 17 -44",radius:"0.05",material:"shader: flat; color: #ccddff; opacity: 0.3",animation:"property: material.opacity; from: 0.1; to: 0.45; dur: 2600; loop: true; dir: alternate"}],decorations:[]},neon:{id:"neon",name:"Neon City",icon:"ðŸ™ï¸",unlockLevel:10,sky:"#050510",floor:"#0a0a20",grid:"#220044",gridOpacity:.4,lights:[{type:"ambient",color:"#110022",intensity:.3},{type:"point",position:"0 10 0",color:"#ff00ff",intensity:1.2,distance:40},{type:"point",position:"-8 6 -8",color:"#00ffff",intensity:.7,distance:25},{type:"point",position:"8 6 -8",color:"#ff0088",intensity:.7,distance:25},{type:"point",position:"0 4 8",color:"#00ff88",intensity:.4,distance:20}],shadowLight:{color:"#ff00ff",intensity:.5,position:"5 12 5"},pillarColor:"#220044",barrierColor:"#440088",floorRingColor1:"#ff00ff",floorRingColor2:"#00ffff",pillarGlowColor:"#ff00ff",baseGlowColor:"#ff00ff",cornerGlowColor:"#ff00ff",skyGradient:{bottom:"#1a0033",mid:"#050510",top:"#0a0020"},floorFadeColor:"#050510",platformSlabColor:"#0a0020",edgeGlowColor:"#ff00ff",underGlowColor:"#ff00ff",underGlowRing1:"#ff00ff",underGlowRing2:"#00ffff",belowEnv:[{tag:"a-sphere",position:"-8 -15 -5",radius:"0.08",material:"shader: flat; color: #ff00ff; emissive: #ff00ff; emissiveIntensity: 1; opacity: 0.3",animation:"property: material.opacity; from: 0.15; to: 0.4; dur: 1500; loop: true; dir: alternate"},{tag:"a-sphere",position:"12 -20 3",radius:"0.06",material:"shader: flat; color: #00ffff; emissive: #00ffff; emissiveIntensity: 1; opacity: 0.25",animation:"property: material.opacity; from: 0.1; to: 0.35; dur: 1800; loop: true; dir: alternate"},{tag:"a-sphere",position:"-3 -12 8",radius:"0.05",material:"shader: flat; color: #ff0088; emissive: #ff0088; emissiveIntensity: 1; opacity: 0.3",animation:"property: material.opacity; from: 0.15; to: 0.4; dur: 2200; loop: true; dir: alternate"},{tag:"a-sphere",position:"6 -25 -10",radius:"0.07",material:"shader: flat; color: #00ff88; emissive: #00ff88; emissiveIntensity: 1; opacity: 0.2",animation:"property: material.opacity; from: 0.1; to: 0.3; dur: 2000; loop: true; dir: alternate"},{tag:"a-sphere",position:"-15 -18 0",radius:"0.09",material:"shader: flat; color: #ff00ff; emissive: #ff00ff; emissiveIntensity: 1; opacity: 0.2",animation:"property: material.opacity; from: 0.1; to: 0.3; dur: 2500; loop: true; dir: alternate"},{tag:"a-sphere",position:"10 -30 -8",radius:"0.06",material:"shader: flat; color: #00ffff; emissive: #00ffff; emissiveIntensity: 1; opacity: 0.15",animation:"property: material.opacity; from: 0.08; to: 0.25; dur: 1700; loop: true; dir: alternate"},{tag:"a-sphere",position:"0 -22 5",radius:"0.05",material:"shader: flat; color: #ff0088; emissive: #ff0088; emissiveIntensity: 1; opacity: 0.25",animation:"property: material.opacity; from: 0.1; to: 0.35; dur: 1900; loop: true; dir: alternate"},{tag:"a-sphere",position:"-12 -28 -3",radius:"0.08",material:"shader: flat; color: #00ff88; emissive: #00ff88; emissiveIntensity: 1; opacity: 0.15",animation:"property: material.opacity; from: 0.08; to: 0.25; dur: 2300; loop: true; dir: alternate"},{tag:"a-sphere",position:"0 -20 0",radius:"15",material:"shader: flat; color: #220044; opacity: 0.05"}],distantEnv:[{tag:"a-box",position:"-22 6 -38",width:"4",height:"12",depth:"4",material:"color: #110022; metalness: 0.8; roughness: 0.3; emissive: #220044; emissiveIntensity: 0.3"},{tag:"a-box",position:"-10 10 -44",width:"5",height:"20",depth:"5",material:"color: #110022; metalness: 0.8; roughness: 0.3; emissive: #220044; emissiveIntensity: 0.3"},{tag:"a-box",position:"5 7 -40",width:"3.5",height:"14",depth:"3.5",material:"color: #110022; metalness: 0.8; roughness: 0.3; emissive: #110033; emissiveIntensity: 0.3"},{tag:"a-box",position:"18 9 -46",width:"4",height:"18",depth:"4",material:"color: #110022; metalness: 0.8; roughness: 0.3; emissive: #220044; emissiveIntensity: 0.3"},{tag:"a-box",position:"28 5 -36",width:"3",height:"10",depth:"3",material:"color: #110022; metalness: 0.8; roughness: 0.3; emissive: #110033; emissiveIntensity: 0.2"},{tag:"a-plane",position:"-22 8 -35.9",width:"3",height:"0.12",material:"shader: flat; color: #ff00ff; emissive: #ff00ff; emissiveIntensity: 1; opacity: 0.6",animation:"property: material.opacity; from: 0.4; to: 0.8; dur: 1500; loop: true; dir: alternate"},{tag:"a-plane",position:"-10 14 -41.4",width:"4",height:"0.12",material:"shader: flat; color: #00ffff; emissive: #00ffff; emissiveIntensity: 1; opacity: 0.6",animation:"property: material.opacity; from: 0.3; to: 0.7; dur: 2000; loop: true; dir: alternate"},{tag:"a-plane",position:"18 12 -43.9",width:"3",height:"0.1",material:"shader: flat; color: #ff0088; emissive: #ff0088; emissiveIntensity: 1; opacity: 0.5",animation:"property: material.opacity; from: 0.3; to: 0.6; dur: 1800; loop: true; dir: alternate"},{tag:"a-plane",position:"5 10 -38.2",width:"2.5",height:"0.1",material:"shader: flat; color: #00ff88; emissive: #00ff88; emissiveIntensity: 1; opacity: 0.5",animation:"property: material.opacity; from: 0.3; to: 0.7; dur: 2200; loop: true; dir: alternate"},{tag:"a-box",position:"-38 8 -12",width:"4",height:"16",depth:"4",material:"color: #110022; metalness: 0.8; roughness: 0.3; emissive: #220044; emissiveIntensity: 0.2"},{tag:"a-plane",position:"-35.9 10 -12",rotation:"0 90 0",width:"3",height:"0.1",material:"shader: flat; color: #ff00ff; emissive: #ff00ff; emissiveIntensity: 1; opacity: 0.5",animation:"property: material.opacity; from: 0.3; to: 0.6; dur: 1600; loop: true; dir: alternate"},{tag:"a-box",position:"40 7 -6",width:"3.5",height:"14",depth:"3.5",material:"color: #110022; metalness: 0.8; roughness: 0.3; emissive: #220044; emissiveIntensity: 0.2"},{tag:"a-plane",position:"38.2 9 -6",rotation:"0 90 0",width:"2.5",height:"0.1",material:"shader: flat; color: #00ffff; emissive: #00ffff; emissiveIntensity: 1; opacity: 0.5",animation:"property: material.opacity; from: 0.3; to: 0.7; dur: 1900; loop: true; dir: alternate"},{tag:"a-torus",position:"0 10 -30",radius:"1.2","radius-tubular":"0.025",material:"color: #ff00ff; emissive: #ff00ff; emissiveIntensity: 1; opacity: 0.3",animation:"property: rotation; to: 360 360 0; dur: 8000; easing: linear; loop: true"},{tag:"a-torus",position:"-15 12 -35",radius:"0.8","radius-tubular":"0.02",material:"color: #00ffff; emissive: #00ffff; emissiveIntensity: 1; opacity: 0.25",animation:"property: rotation; to: 0 360 360; dur: 10000; easing: linear; loop: true"}],decorations:[]},day:{id:"day",name:"Open Sky",icon:"â˜€ï¸",unlockLevel:1,sky:"#87CEEB",floor:"#aaaaaa",grid:"#999999",gridOpacity:.15,lights:[{type:"ambient",color:"#888888",intensity:.8},{type:"point",position:"0 10 0",color:"#ffffcc",intensity:1.5,distance:50},{type:"point",position:"-8 6 -8",color:"#ffeecc",intensity:.4,distance:25},{type:"point",position:"8 6 -8",color:"#ccddff",intensity:.4,distance:25},{type:"point",position:"0 4 8",color:"#ffffdd",intensity:.3,distance:20}],shadowLight:{color:"#ffffee",intensity:.8,position:"8 15 5"},pillarColor:"#888899",barrierColor:"#44aaff",floorRingColor1:"#44cc88",floorRingColor2:"#44aaff",pillarGlowColor:"#44cc88",baseGlowColor:"#44aaff",cornerGlowColor:"#44aaff",skyGradient:{bottom:"#b8d4e8",mid:"#87CEEB",top:"#4a90d9"},floorFadeColor:"#87CEEB",platformSlabColor:"#888888",edgeGlowColor:"#44cc88",underGlowColor:"#44aaff",underGlowRing1:"#44cc88",underGlowRing2:"#44aaff",belowEnv:[{tag:"a-plane",position:"0 -40 0",rotation:"-90 0 0",width:"200",height:"200",material:"shader: flat; color: #558844; opacity: 0.25"},{tag:"a-sphere",position:"-6 -5 -8",radius:"4",material:"shader: flat; color: #ffffff; opacity: 0.08"},{tag:"a-sphere",position:"10 -8 3",radius:"5",material:"shader: flat; color: #ffffff; opacity: 0.06"},{tag:"a-sphere",position:"-3 -10 10",radius:"6",material:"shader: flat; color: #eeeeff; opacity: 0.05"},{tag:"a-sphere",position:"8 -12 -12",radius:"3.5",material:"shader: flat; color: #ffffff; opacity: 0.07"},{tag:"a-sphere",position:"-12 -7 0",radius:"4.5",material:"shader: flat; color: #ffffff; opacity: 0.06"}],distantEnv:[{tag:"a-sphere",position:"-20 -2 -45",radius:"12",material:"shader: flat; color: #4a8844; opacity: 0.5"},{tag:"a-sphere",position:"5 -3 -50",radius:"15",material:"shader: flat; color: #3d7a3d; opacity: 0.45"},{tag:"a-sphere",position:"30 -2.5 -42",radius:"10",material:"shader: flat; color: #4a8844; opacity: 0.5"},{tag:"a-sphere",position:"-40 -2 -15",radius:"11",material:"shader: flat; color: #3d7a3d; opacity: 0.4"},{tag:"a-sphere",position:"-45 -3 5",radius:"9",material:"shader: flat; color: #4a8844; opacity: 0.35"},{tag:"a-sphere",position:"42 -2 -10",radius:"10",material:"shader: flat; color: #4a8844; opacity: 0.4"},{tag:"a-sphere",position:"-15 12 -35",radius:"4",material:"shader: flat; color: #ffffff; opacity: 0.25"},{tag:"a-sphere",position:"-13 12.5 -36",radius:"3.5",material:"shader: flat; color: #ffffff; opacity: 0.2"},{tag:"a-sphere",position:"20 14 -40",radius:"5",material:"shader: flat; color: #ffffff; opacity: 0.22"},{tag:"a-sphere",position:"22 14.5 -41",radius:"4",material:"shader: flat; color: #ffffff; opacity: 0.18"},{tag:"a-sphere",position:"-30 10 -25",radius:"3",material:"shader: flat; color: #ffffff; opacity: 0.2"},{tag:"a-sphere",position:"35 11 -20",radius:"3.5",material:"shader: flat; color: #ffffff; opacity: 0.18"},{tag:"a-cone",position:"-18 3 -38","radius-bottom":"0.4","radius-top":"0",height:"3",material:"shader: flat; color: #2d5a2d; opacity: 0.6"},{tag:"a-cone",position:"-15 2.5 -40","radius-bottom":"0.5","radius-top":"0",height:"3.5",material:"shader: flat; color: #2d5a2d; opacity: 0.55"},{tag:"a-cone",position:"8 2 -42","radius-bottom":"0.45","radius-top":"0",height:"3",material:"shader: flat; color: #2d5a2d; opacity: 0.6"},{tag:"a-cone",position:"12 2.5 -44","radius-bottom":"0.5","radius-top":"0",height:"4",material:"shader: flat; color: #2d5a2d; opacity: 0.55"},{tag:"a-cone",position:"28 2 -36","radius-bottom":"0.4","radius-top":"0",height:"3",material:"shader: flat; color: #2d5a2d; opacity: 0.6"},{tag:"a-plane",position:"15 -0.5 -48",rotation:"-90 0 0",width:"12",height:"6",material:"shader: flat; color: #4488cc; opacity: 0.2"}],decorations:[]}};function Q(o,t,e){t.forEach(a=>{const r=document.createElement(a.tag);r.classList.add(e);for(const[i,s]of Object.entries(a))i!=="tag"&&r.setAttribute(i,s);o.appendChild(r)})}function Ht(o,t){const e=J[t]||J.cyber,a=o.querySelector("#game-content")||o,r=o.querySelector("a-sky");r&&r.setAttribute("color",e.sky);const i=a.querySelector("#platform-surface");i&&i.setAttribute("material",`color: ${e.floor}; metalness: 0.8; roughness: 0.4`);const s=a.querySelector("#platform-slab");if(s){const c=e.platformSlabColor||"#0a0a22";s.setAttribute("material",`color: ${c}; metalness: 0.9; roughness: 0.2`)}const n=e.edgeGlowColor||"#0088ff";a.querySelectorAll(".platform-edge").forEach(c=>{c.setAttribute("material",`shader: flat; color: ${n}; emissive: ${n}; emissiveIntensity: 1; opacity: 0.5`)});const l=a.querySelectorAll(".under-glow-ring");if(l.length>=2){const c=e.underGlowRing1||"#0088ff",y=e.underGlowRing2||"#00d4ff";l[0].setAttribute("material",`color: ${c}; emissive: ${c}; emissiveIntensity: 1; opacity: 0.2`),l[1].setAttribute("material",`color: ${y}; emissive: ${y}; emissiveIntensity: 0.8; opacity: 0.15`)}const p=a.querySelector(".under-glow-light");p&&p.setAttribute("color",e.underGlowColor||"#0088ff");const f=a.querySelector("#floor-grid a-plane");f&&f.setAttribute("material",`color: ${e.grid}; wireframe: true; wireframeLinewidth: 1; opacity: ${e.gridOpacity}`),a.querySelectorAll(".arena-barrier").forEach(c=>{c.setAttribute("material",`shader: flat; color: ${e.barrierColor}; opacity: 0.04; transparent: true; side: double`)});const b=a.querySelectorAll(":scope > a-torus");b.length>=2&&(e.floorRingColor1&&b[0].setAttribute("material",`color: ${e.floorRingColor1}; emissive: ${e.floorRingColor1}; emissiveIntensity: 0.8; opacity: 0.2`),e.floorRingColor2&&b[1].setAttribute("material",`color: ${e.floorRingColor2}; emissive: ${e.floorRingColor2}; emissiveIntensity: 0.6; opacity: 0.15`));const w=e.baseGlowColor||"#0088ff";a.querySelectorAll(".wall-base-glow").forEach(c=>{c.setAttribute("material",`shader: flat; color: ${w}; emissive: ${w}; emissiveIntensity: 1; opacity: 0.5`)});const h=e.cornerGlowColor||"#0088ff";a.querySelectorAll(".wall-corner-glow").forEach(c=>{c.setAttribute("material",`color: ${h}; emissive: ${h}; emissiveIntensity: 1; opacity: 0.4`)}),a.querySelectorAll(".arena-pillar").forEach(c=>{const y=c.querySelector("a-cylinder");y&&y.setAttribute("material",`color: ${e.pillarColor}; metalness: 0.9; roughness: 0.2`);const v=c.querySelector("a-torus");v&&e.pillarGlowColor&&v.setAttribute("material",`color: ${e.pillarGlowColor}; emissive: ${e.pillarGlowColor}; emissiveIntensity: 0.8; opacity: 0.3`)}),a.querySelectorAll(":scope > a-light").forEach((c,y)=>{if(y<e.lights.length){const v=e.lights[y];c.setAttribute("type",v.type),c.setAttribute("color",v.color),c.setAttribute("intensity",String(v.intensity)),v.position&&c.setAttribute("position",v.position),v.distance&&c.setAttribute("distance",String(v.distance))}});let g=a.querySelector("#shadow-dir-light");g||(g=document.createElement("a-light"),g.id="shadow-dir-light",a.appendChild(g));const S=e.shadowLight||{color:"#4466ff",intensity:.6,position:"5 12 5"};g.setAttribute("type","directional"),g.setAttribute("color",S.color),g.setAttribute("intensity",String(S.intensity)),g.setAttribute("position",S.position),g.setAttribute("light","castShadow: true; shadowMapWidth: 1024; shadowMapHeight: 1024; shadowCameraLeft: -20; shadowCameraRight: 20; shadowCameraTop: 20; shadowCameraBottom: -20; shadowCameraNear: 0.5; shadowCameraFar: 50"),a.querySelectorAll(".floor-edge-gradient").forEach(c=>c.remove()),[{pos:"0 0.02 -15",rot:"-90 0 0",w:32,h:2},{pos:"0 0.02 15",rot:"-90 0 0",w:32,h:2},{pos:"-15 0.02 0",rot:"-90 90 0",w:32,h:2},{pos:"15 0.02 0",rot:"-90 90 0",w:32,h:2}].forEach(c=>{const y=document.createElement("a-plane");y.classList.add("floor-edge-gradient"),y.setAttribute("position",c.pos),y.setAttribute("rotation",c.rot),y.setAttribute("width",String(c.w)),y.setAttribute("height",String(c.h)),y.setAttribute("material","shader: flat; color: #000000; opacity: 0.25; transparent: true"),a.appendChild(y)});const C=a.querySelector("#sky-gradient");if(C){for(;C.firstChild;)C.firstChild.remove();const c=e.skyGradient;if(c){const y=document.createElement("a-sphere");y.setAttribute("radius","90"),y.setAttribute("position","0 -20 0"),y.setAttribute("material",`shader: flat; color: ${c.bottom}; opacity: 0.08; side: back; transparent: true`),C.appendChild(y);const v=document.createElement("a-sphere");v.setAttribute("radius","85"),v.setAttribute("position","0 -5 0"),v.setAttribute("material",`shader: flat; color: ${c.mid}; opacity: 0.05; side: back; transparent: true`),C.appendChild(v);const $=document.createElement("a-sphere");$.setAttribute("radius","80"),$.setAttribute("position","0 15 0"),$.setAttribute("material",`shader: flat; color: ${c.top}; opacity: 0.06; side: back; transparent: true`),C.appendChild($)}}const V=a.querySelector("#floor-fade");if(V){for(;V.firstChild;)V.firstChild.remove();const c=e.floorFadeColor||e.sky;[{pos:"0 0.015 -15.5",rot:"-90 0 0",w:32,h:2},{pos:"0 0.015 15.5",rot:"-90 0 0",w:32,h:2},{pos:"-15.5 0.015 0",rot:"-90 0 0",w:2,h:32},{pos:"15.5 0.015 0",rot:"-90 0 0",w:2,h:32}].forEach(v=>{const $=document.createElement("a-plane");$.setAttribute("position",v.pos),$.setAttribute("rotation",v.rot),$.setAttribute("width",String(v.w)),$.setAttribute("height",String(v.h)),$.setAttribute("material",`shader: flat; color: ${c}; opacity: 0.5; transparent: true`),V.appendChild($)})}const z=a.querySelector("#below-void");if(z){for(;z.firstChild;)z.firstChild.remove();e.belowEnv&&Q(z,e.belowEnv,"below-decoration")}const D=a.querySelector("#distant-env");if(D){for(;D.firstChild;)D.firstChild.remove();e.distantEnv&&Q(D,e.distantEnv,"distant-decoration")}a.querySelectorAll(".theme-decoration").forEach(c=>c.remove()),e.decorations&&e.decorations.length>0&&Q(a,e.decorations,"theme-decoration")}function ae(){return J}const qt={default:{id:"default",name:"Default",laserColor:null,laserOpacity:null,burstColor:null,unlockType:"free",unlockValue:0},fire:{id:"fire",name:"Fire",laserColor:"#ff4400",laserOpacity:.8,burstColor:"#ff6600",unlockType:"level",unlockValue:5},ice:{id:"ice",name:"Ice",laserColor:"#00ddff",laserOpacity:.85,burstColor:"#88eeff",unlockType:"level",unlockValue:8},neon:{id:"neon",name:"Neon",laserColor:"#ff00cc",laserOpacity:.9,burstColor:"#ff44dd",unlockType:"coins",unlockValue:100},gold:{id:"gold",name:"Gold",laserColor:"#ffd700",laserOpacity:.85,burstColor:"#ffee44",unlockType:"achievement",unlockValue:"centurion"},phantom:{id:"phantom",name:"Phantom",laserColor:"#8844ff",laserOpacity:.5,burstColor:"#9966ff",unlockType:"level",unlockValue:12},electric:{id:"electric",name:"Electric",laserColor:"#4488ff",laserOpacity:.9,burstColor:"#66aaff",unlockType:"coins",unlockValue:150},rainbow:{id:"rainbow",name:"Rainbow",laserColor:"#ff0000",laserOpacity:.8,burstColor:"#ffffff",unlockType:"level",unlockValue:15,rainbow:!0}};function Nt(o,t){const e=qt[o];return!e||o==="default"?{}:{laserColor:e.laserColor||t.laserColor,laserOpacity:e.laserOpacity||t.laserOpacity,burstColor:e.burstColor}}const pt={cyber:{bassFreq:40,bassType:"sine",padFreq:220,padFilter:400,tempo:.5,arpNotes:[330,440,550,660]},sunset:{bassFreq:55,bassType:"triangle",padFreq:165,padFilter:300,tempo:.4,arpNotes:[262,330,392,440]},space:{bassFreq:30,bassType:"sine",padFreq:110,padFilter:250,tempo:.3,arpNotes:[880,1047,1175,1319]},neon:{bassFreq:80,bassType:"square",padFreq:330,padFilter:600,tempo:.7,arpNotes:[523,659,784,880]},day:{bassFreq:50,bassType:"triangle",padFreq:196,padFilter:350,tempo:.45,arpNotes:[294,370,440,523]}};class Ft{constructor(){this._nodes=[],this._intervals=[],this._playing=!1,this._enabled=!0}loadSettings(){try{const t=localStorage.getItem("vr_quest_player_v2");if(t){const a=JSON.parse(t).settings||{};this._enabled=a.music!==!1}}catch{}}startMusic(t){if(!this._enabled)return;this.stopMusic();const e=_._getCtx();if(!e)return;const a=_.destination;if(!a)return;const r=pt[t]||pt.cyber;this._playing=!0;const i=e.createGain();i.gain.value=0,i.connect(a),i.gain.linearRampToValueAtTime(.08,e.currentTime+2),this._nodes.push(i),this._masterGain=i;const s=e.createOscillator(),n=e.createGain();s.type=r.bassType,s.frequency.value=r.bassFreq,n.gain.value=.4,s.connect(n).connect(i),s.start(),this._nodes.push(s,n);const l=setInterval(()=>{this._playing&&(n.gain.setValueAtTime(.4,e.currentTime),n.gain.linearRampToValueAtTime(.15,e.currentTime+1/r.tempo),n.gain.linearRampToValueAtTime(.4,e.currentTime+2/r.tempo))},2/r.tempo*1e3);this._intervals.push(l);const p=e.createOscillator(),f=e.createGain(),m=e.createBiquadFilter();p.type="sawtooth",p.frequency.value=r.padFreq,m.type="lowpass",m.frequency.value=r.padFilter,m.Q.value=2,f.gain.value=.1,p.connect(m).connect(f).connect(i),p.start(),this._nodes.push(p,f,m);const b=setInterval(()=>{if(!this._playing)return;const h=r.padFreq*(.9+Math.random()*.2);p.frequency.linearRampToValueAtTime(h,e.currentTime+2)},4e3);this._intervals.push(b);const w=setInterval(()=>{if(!this._playing)return;const h=r.arpNotes[Math.floor(Math.random()*r.arpNotes.length)],T=e.createOscillator(),d=e.createGain();T.type="sine",T.frequency.value=h,d.gain.setValueAtTime(.08,e.currentTime),d.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.5),T.connect(d).connect(i),T.start(),T.stop(e.currentTime+1.5)},3/r.tempo*1e3);this._intervals.push(w)}setPlaybackRate(t){if(!(!this._playing||!this._masterGain))try{const e=_._getCtx(),a=Math.log2(t)*1200;this._nodes.forEach(r=>{r instanceof OscillatorNode&&r.detune.setValueAtTime(a,e.currentTime)})}catch{}}stopMusic(){if(this._playing=!1,this._masterGain)try{const t=_._getCtx();this._masterGain.gain.linearRampToValueAtTime(0,t.currentTime+.5)}catch{}setTimeout(()=>{this._intervals.forEach(t=>clearInterval(t)),this._intervals=[],this._nodes.forEach(t=>{try{t.stop&&t.stop()}catch{}try{t.disconnect()}catch{}}),this._nodes=[],this._masterGain=null},600)}}const X=new Ft;function Xt(o,t,e,a){var h;const r=o.score,i=a.targetsHit,s=a.bestCombo,n=o.shotsFired||0,l=n>0?Math.round(i/n*100):0,p=((h=t==null?void 0:t.highScores)==null?void 0:h[e.id])||0,f=r>p&&r>0,m=r-p,b=Math.floor(r/5),w=Math.floor(b*e.xpMultiplier);return{score:r,targetsHit:i,bestCombo:s,shotsFired:n,accuracy:l,isNewHigh:f,vsBest:m,xpEarned:w,modeName:e.name,modeIcon:e.icon}}class Vt{pulse(t,e){const r=(Y().vibration??50)/100;if(r===0)return;const i=Math.min(t*r,1);["left-hand","right-hand"].forEach(s=>{var p,f,m,b,w;const n=document.getElementById(s),l=((p=n==null?void 0:n.components)==null?void 0:p["oculus-touch-controls"])||((f=n==null?void 0:n.components)==null?void 0:f["tracked-controls"]);if((w=(b=(m=l==null?void 0:l.controller)==null?void 0:m.gamepad)==null?void 0:b.hapticActuators)!=null&&w[0])try{l.controller.gamepad.hapticActuators[0].pulse(i,e)}catch{}})}hit(){this.pulse(.4,40)}combo(t){this.pulse(Math.min(.3+t*.05,1),60)}powerUp(){this._pattern([.5,80],[0,50],[.7,80])}slowMo(){this.pulse(.8,200)}damageTaken(){this._pattern([1,100],[0,50],[1,100])}bossKill(){this._pattern([.6,60],[0,40],[.8,80],[0,40],[1,120])}async _pattern(...t){for(const[e,a]of t)e>0&&this.pulse(e,a),await new Promise(r=>setTimeout(r,a))}}const at=new Vt,zt=3;let I,N,k,Z,ft=!1;window.__weaponSystem=H;window.__hapticManager=at;function ie({mode:o,weapon:t,theme:e,onReturnToMenu:a}){o&&O.select(o),t&&H.select(t),Z=a,ft||(Dt(),ft=!0),Kt(e)}let U,E,M,x,tt,et,L,G,R;function Dt(){if(U=document.getElementById("hud-score"),E=document.getElementById("hud-timer"),M=document.getElementById("hud-combo"),x=document.getElementById("hud-lives"),tt=document.getElementById("hud-weapon"),et=document.getElementById("hud-level"),L=document.getElementById("hud-powerup"),G=document.getElementById("scene"),R=document.getElementById("btn-quit-vr"),R){const a=R.querySelector("a-plane");if(a){const r=()=>{it()};a.addEventListener("click",r),a.addEventListener("hit",r),a.addEventListener("mouseenter",()=>{a.setAttribute("material","opacity",1),a.setAttribute("color","#882222")}),a.addEventListener("mouseleave",()=>{a.setAttribute("material","opacity",.9),a.setAttribute("color","#661a1a")})}}document.addEventListener("shot-fired",()=>{W.state===F.PLAYING&&(B.recordShot(),document.dispatchEvent(new CustomEvent("camera-fov-punch")))}),G.addEventListener("click",()=>{W.state===F.PLAYING&&B.recordShot()}),jt(G),document.addEventListener("slow-motion",a=>{Y().reducedMotion||(a.detail.active?(Wt(),X.setPlaybackRate(.5),document.dispatchEvent(new CustomEvent("camera-impact-zoom",{detail:{duration:200}}))):(Ut(),X.setPlaybackRate(1)))});const o=document.getElementById("hud-boss"),t=document.getElementById("boss-bar-fill"),e=document.getElementById("boss-bar-label");document.addEventListener("boss-spawn",a=>{if(o&&(o.setAttribute("visible","true"),t&&(t.setAttribute("width","0.5"),t.setAttribute("color","#44ff44")),e)){const r=a.detail.wave;e.setAttribute("value",r>0&&r%5===0?`BOSS WAVE ${r}!`:`WAVE ${r+1}`)}}),document.addEventListener("boss-damaged",a=>{if(!o||!t)return;const{hp:r,maxHp:i}=a.detail,s=r/i;t.setAttribute("width",String(.5*s)),s>.5?t.setAttribute("color","#44ff44"):s>.25?t.setAttribute("color","#ffaa00"):t.setAttribute("color","#ff3333"),_.playBossHit()}),document.addEventListener("boss-killed",a=>{var r;o&&(setTimeout(()=>o.setAttribute("visible","false"),500),G&&((r=a.detail)!=null&&r.position)&&gt(G,a.detail.position,8,"#ffd700"),document.dispatchEvent(new CustomEvent("camera-shake",{detail:{intensity:.03,duration:300}})))}),document.addEventListener("boss-wave-clear",a=>{M&&(M.setAttribute("value",`WAVE ${a.detail.wave} CLEAR!`),M.setAttribute("color","#ffd700"),M.setAttribute("animation__pop",{property:"scale",from:"0.6 0.6 0.6",to:"0.4 0.4 0.4",dur:300,easing:"easeOutElastic"}),setTimeout(()=>M.setAttribute("value",""),2e3))})}function Wt(){let o=document.getElementById("slow-mo-overlay");o||(o=document.createElement("div"),o.id="slow-mo-overlay",o.className="slow-mo-overlay",document.body.appendChild(o)),o.offsetWidth,o.classList.add("active")}function Ut(){const o=document.getElementById("slow-mo-overlay");o&&o.classList.remove("active")}function Kt(o){var r;const t=document.getElementById("target-container"),e=O.current;I=new It(t,{spawnInterval:e.spawnInterval,maxTargets:e.maxTargets,targetLifetime:e.targetLifetime,bossMode:e.id==="bossRush"}),_.loadSettings(),K=o||((r=u.profile)==null?void 0:r.selectedTheme)||"cyber",Ht(G,K);const a=Y();if(Qt(a),Yt(),tt&&tt.setAttribute("value",`${H.current.icon} ${H.current.name}`),et){const i=u.profile;i&&et.setAttribute("value",`Lv.${i.level}`)}ot(),P.onUpdate=i=>{if(!L)return;if(!i){L.setAttribute("value","");return}const s=(i.remaining/1e3).toFixed(1);L.setAttribute("value",`${i.label} ${s}s`),L.setAttribute("color",i.color)},P.onDeactivate=()=>{L&&L.setAttribute("value","")},B.onChange(i=>{U.setAttribute("value",`Score: ${i}`),U.setAttribute("animation__pop",{property:"scale",from:"0.42 0.42 0.42",to:"0.35 0.35 0.35",dur:150,easing:"easeOutQuad"})}),I.onComboChange=i=>{if(i>=2){M.setAttribute("value",`x${i} COMBO!`);let s="#ff44aa";if(i>=10?s="#ffd700":i>=5&&(s="#ff8800"),i>=5){const n=i>=15?.025:i>=10?.018:.01,l=i>=15?200:i>=10?150:100;document.dispatchEvent(new CustomEvent("camera-shake",{detail:{intensity:n,duration:l}}))}if(M.setAttribute("color",s),M.setAttribute("animation__pop",{property:"scale",from:"0.5 0.5 0.5",to:"0.4 0.4 0.4",dur:200,easing:"easeOutElastic"}),i>=10){M.setAttribute("animation__shake",{property:"position",from:"-0.01 0.2 -1",to:"0.01 0.2 -1",dur:80,loop:3,dir:"alternate",easing:"linear"});const n=document.getElementById("camera");if(n&&G){const l=n.object3D.getWorldPosition(new THREE.Vector3);gt(G,{x:l.x,y:l.y,z:l.z-2},5,s)}}}else M.setAttribute("value","")},I.onMiss=()=>{if(O.current.lives!==1/0){const s=O.loseLife();_.playLifeLost(),at.damageTaken(),ot(),x&&(x.setAttribute("animation__shake",{property:"position",from:"-0.47 0.22 -1",to:"-0.43 0.22 -1",dur:80,loop:3,dir:"alternate",easing:"linear"}),setTimeout(()=>{x.setAttribute("position","-0.45 0.22 -1"),x.removeAttribute("animation__shake")},500)),s&&it()}},Jt()}function ot(){if(!x)return;const o=O.lives;o===1/0?x.setAttribute("value",""):x.setAttribute("value","â™¥".repeat(Math.max(0,o)))}function Yt(){var l;const o=H.current,t=u.profile,e=((l=t==null?void 0:t.weaponSkins)==null?void 0:l[o.id])||"default",a=Nt(e,o),r=a.laserColor||o.laserColor,i=a.laserOpacity||o.laserOpacity,s=document.getElementById("right-hand"),n=document.getElementById("left-hand");s&&(s.setAttribute("raycaster","lineColor",r),s.setAttribute("raycaster","lineOpacity",i)),n&&(n.setAttribute("raycaster","lineColor",r),n.setAttribute("raycaster","lineOpacity",i))}const ut={cyber:{dust:"#aaccff",sparks:"#00d4ff",debris:"#4466ff"},sunset:{dust:"#ffccaa",sparks:"#ff6600",debris:"#ff4400"},space:{dust:"#8899cc",sparks:"#4488ff",debris:"#6644ff"},neon:{dust:"#ff88ff",sparks:"#ff00ff",debris:"#00ffff"},day:{dust:"#ffffcc",sparks:"#44cc88",debris:"#88bbdd"}};function jt(o){const t=ut[K]||ut.cyber;for(let a=0;a<40;a++){const r=document.createElement("a-sphere"),i=(Math.random()-.5)*28,s=Math.random()*5+.3,n=(Math.random()-.5)*28;r.setAttribute("class","ambient-particle"),r.setAttribute("radius",String(.008+Math.random()*.012)),r.setAttribute("material",`shader: flat; color: ${t.dust}; opacity: ${.08+Math.random()*.12}`),r.setAttribute("position",`${i} ${s} ${n}`),r.setAttribute("animation",{property:"position",to:`${i+(Math.random()-.5)*3} ${s+.5+Math.random()*1.5} ${n+(Math.random()-.5)*3}`,dur:8e3+Math.random()*6e3,easing:"linear",loop:!0,dir:"alternate"}),o.appendChild(r)}for(let a=0;a<20;a++){const r=document.createElement("a-sphere"),i=(Math.random()-.5)*24,s=Math.random()*4+1,n=(Math.random()-.5)*24;r.setAttribute("class","ambient-particle"),r.setAttribute("radius",String(.006+Math.random()*.008)),r.setAttribute("material",`shader: flat; color: ${t.sparks}; opacity: ${.3+Math.random()*.4}`),r.setAttribute("position",`${i} ${s} ${n}`),r.setAttribute("animation__drift",{property:"position",to:`${i+(Math.random()-.5)*5} ${s+(Math.random()-.5)*3} ${n+(Math.random()-.5)*5}`,dur:2e3+Math.random()*2e3,easing:"easeInOutSine",loop:!0,dir:"alternate"}),r.setAttribute("animation__twinkle",{property:"material.opacity",from:.1,to:.6+Math.random()*.3,dur:600+Math.random()*800,loop:!0,dir:"alternate",easing:"easeInOutSine"}),o.appendChild(r)}const e=["a-icosahedron","a-octahedron","a-dodecahedron"];for(let a=0;a<10;a++){const r=e[Math.floor(Math.random()*e.length)],i=document.createElement(r),s=(Math.random()-.5)*26,n=Math.random()*4+1,l=(Math.random()-.5)*26;i.setAttribute("class","ambient-particle"),i.setAttribute("radius",String(.02+Math.random()*.03)),i.setAttribute("material",`color: ${t.debris}; metalness: 0.7; roughness: 0.3; emissive: ${t.debris}; emissiveIntensity: 0.3; opacity: ${.15+Math.random()*.2}`),i.setAttribute("position",`${s} ${n} ${l}`),i.setAttribute("animation__float",{property:"position",to:`${s+(Math.random()-.5)*2} ${n+Math.random()*2} ${l+(Math.random()-.5)*2}`,dur:7e3+Math.random()*5e3,easing:"easeInOutSine",loop:!0,dir:"alternate"}),i.setAttribute("animation__spin",{property:"rotation",to:`${Math.random()*360} ${Math.random()*360} ${Math.random()*360}`,dur:6e3+Math.random()*6e3,easing:"linear",loop:!0}),o.appendChild(i)}}function gt(o,t,e,a){for(let r=0;r<e;r++){const i=document.createElement("a-sphere");i.setAttribute("radius","0.01"),i.setAttribute("material",`shader: flat; color: ${a}; opacity: 0.7`),i.setAttribute("position",`${t.x} ${t.y} ${t.z}`);const s=(Math.random()-.5)*3,n=Math.random()*2,l=(Math.random()-.5)*3;i.setAttribute("animation__burst",{property:"position",to:`${t.x+s} ${t.y+n} ${t.z+l}`,dur:400+Math.random()*200,easing:"easeOutQuad"}),i.setAttribute("animation__fade",{property:"material.opacity",from:.7,to:0,dur:500,easing:"easeOutQuad"}),o.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},600)}}function Qt(o){const t=document.getElementById("crosshair");if(t){t.setAttribute("material",`shader: flat; color: ${o.crosshairColor}; opacity: 0.8`),t.setAttribute("color",o.crosshairColor);const r={small:{inner:.007,outer:.01},medium:{inner:.01,outer:.015},large:{inner:.015,outer:.022}},i=r[o.crosshairSize]||r.medium;t.setAttribute("radius-inner",String(i.inner)),t.setAttribute("radius-outer",String(i.outer))}!o.showCombo&&M&&M.setAttribute("visible","false");const e=document.querySelector("a-scene");e&&e.hasAttribute("bloom-effect")&&e.setAttribute("bloom-effect","enabled",o.bloom!==!1);const a=document.getElementById("camera");a&&a.hasAttribute("camera-effects")&&a.setAttribute("camera-effects","shakeLevel",o.screenShake||"medium")}function Jt(){let o=zt;const t=document.getElementById("hud-countdown");t&&(t.setAttribute("value",String(o)),t.setAttribute("visible","true"),t.setAttribute("scale","0.8 0.8 0.8"));const e=setInterval(()=>{o--,o>0?(t&&(t.setAttribute("value",String(o)),t.setAttribute("animation__pop",{property:"scale",from:"1.0 1.0 1.0",to:"0.8 0.8 0.8",dur:300,easing:"easeOutQuad"})),_.playCountdownBeep(),at.pulse(.2,30)):(t&&(t.setAttribute("value","GO!"),t.setAttribute("color","#ffaa00"),t.setAttribute("animation__pop",{property:"scale",from:"1.2 1.2 1.2",to:"0.8 0.8 0.8",dur:400,easing:"easeOutElastic"})),_.playGo(),clearInterval(e),setTimeout(()=>{t&&(t.setAttribute("visible","false"),t.setAttribute("color","#00ff88")),Zt()},500))},1e3)}let K="cyber";function Zt(){B.reset(),P.reset(),k=O.current.duration,O.startRound(),W.changeState(F.PLAYING),R&&R.setAttribute("visible","true"),I.start(),X.loadSettings(),X.startMusic(K),U.setAttribute("value","Score: 0"),M.setAttribute("value",""),E.removeAttribute("animation__pulse"),E.setAttribute("scale","0.35 0.35 0.35"),k===1/0?(E.setAttribute("value","âˆž"),E.setAttribute("color","#44ff44")):(E.setAttribute("value",String(k)),E.setAttribute("color","#ffaa00")),ot(),N&&clearInterval(N),k!==1/0&&(N=setInterval(()=>{if(P.isTimeFrozen()){E.setAttribute("color","#00d4ff");return}k--,E.setAttribute("value",String(k)),k<=5?(E.setAttribute("color","#ff0000"),E.setAttribute("animation__pulse",{property:"scale",from:"0.35 0.35 0.35",to:"0.45 0.45 0.45",dur:400,loop:!0,dir:"alternate",easing:"easeInOutSine"})):k<=10?(E.setAttribute("color","#ff4444"),E.setAttribute("animation__pulse",{property:"scale",from:"0.35 0.35 0.35",to:"0.42 0.42 0.42",dur:500,loop:!0,dir:"alternate",easing:"easeInOutSine"})):(E.setAttribute("color","#ffaa00"),E.removeAttribute("animation__pulse"),E.setAttribute("scale","0.35 0.35 0.35")),k<=0&&it()},1e3))}async function it(){N&&clearInterval(N),R&&R.setAttribute("visible","false"),W.changeState(F.GAME_OVER),I.stop(),P.reset(),X.stopMusic(),_.playGameOver();const o=B.finalize(),t=O.current,e=Xt(o,u.profile,t,I),a=e.xpEarned,r=await u.updateHighScore(t.id,o.score),i=await u.addXp(a);await u.recordGameResult({targetsHit:I.targetsHit,bestCombo:I.bestCombo});const s=u.profile,n=H.currentId,l={...s.weaponUsage||{}};l[n]=(l[n]||0)+1;const p={...s.modeStats||{}};p[t.id]||(p[t.id]={games:0}),p[t.id].games++;const f=[...s.recentGames||[]];f.push({mode:t.id,weapon:n,score:o.score,targets:I.targetsHit,date:Date.now()}),f.length>10&&f.shift(),await u.saveProfile({weaponUsage:l,modeStats:p,recentGames:f}),r&&Gt.submitScore(t.id,o.score).catch(()=>{}),await Rt({score:o.score,targetsHit:I.targetsHit,bestCombo:I.bestCombo,mode:t.id,weapon:n}),await Bt(),i.leveledUp&&_.playLevelUp();const m=document.getElementById("hud-gameover");if(m){const b=document.getElementById("hud-go-score"),w=document.getElementById("hud-go-stats"),h=document.getElementById("hud-go-title");b&&b.setAttribute("value",`Score: ${o.score}`),w&&w.setAttribute("value",`Targets: ${I.targetsHit}  |  Combo: x${I.bestCombo}  |  Acc: ${e.accuracy}%`),h&&r&&h.setAttribute("value","NEW HIGH SCORE!"),h&&r&&h.setAttribute("color","#ffd700"),m.setAttribute("visible","true"),["hud-score","hud-timer","hud-combo","hud-lives","hud-weapon","hud-level","hud-powerup","hud-boss"].forEach(T=>{const d=document.getElementById(T);d&&d.setAttribute("visible","false")}),setTimeout(()=>{m.setAttribute("visible","false"),h&&(h.setAttribute("value","GAME OVER"),h.setAttribute("color","#ff4444")),Z&&Z()},4e3)}}export{ae as g,ie as s};
