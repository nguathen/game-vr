<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VR Quest Game V2 - Play</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>
  <div id="transition" class="transition"></div>

  <!-- Game Over overlay -->
  <div id="game-over-overlay" class="hidden">
    <div class="menu game-over-menu">
      <h1 class="game-over-title">Game Over</h1>
      <div id="new-high-badge" class="new-high-badge hidden">NEW HIGH SCORE!</div>
      <div class="score-section">
        <p id="final-score" class="final-score">0</p>
        <p id="final-high-score" class="final-high-score">High Score: 0</p>
      </div>
      <div class="stats-section">
        <div class="stat-box">
          <span id="stat-targets" class="stat-box-value">0</span>
          <span class="stat-box-label">Targets</span>
        </div>
        <div class="stat-box">
          <span id="stat-combo" class="stat-box-value">x0</span>
          <span class="stat-box-label">Best Combo</span>
        </div>
        <div class="stat-box">
          <span id="stat-accuracy" class="stat-box-value">0%</span>
          <span class="stat-box-label">Accuracy</span>
        </div>
      </div>
      <div class="xp-section">
        <p id="final-xp" class="xp-display">+0 XP</p>
        <div class="xp-bar-go"><div id="xp-fill-go" class="xp-fill"></div></div>
      </div>
      <div class="buttons">
        <button id="btn-retry" class="btn btn-primary">Retry</button>
        <button id="btn-share" class="btn btn-secondary">Share</button>
        <button id="btn-menu" class="btn btn-secondary">Main Menu</button>
      </div>
    </div>
  </div>

  <!-- Quit button (visible during gameplay) -->
  <button id="btn-quit" class="btn-quit hidden">âœ• Quit</button>

  <!-- Countdown overlay -->
  <div id="countdown-overlay" class="hidden">
    <div class="countdown-text" id="countdown-number">3</div>
  </div>

  <!-- Register A-Frame components before scene -->
  <script src="./js/components/smooth-locomotion.js"></script>
  <script src="./js/components/shoot-controls.js"></script>
  <script src="./js/components/particle-burst.js"></script>
  <script src="./js/components/damage-number.js"></script>
  <script src="./js/components/target-hit.js"></script>

  <a-scene id="game-scene" vr-mode-ui="enterVRButton: #enter-vr-custom">
    <!-- Player Rig -->
    <a-entity id="player-rig" position="0 0 0" smooth-locomotion="speed: 3; camera: #camera">
      <a-camera id="camera" position="0 1.6 0" wasd-controls="acceleration: 20" look-controls>
        <!-- Crosshair -->
        <a-ring id="crosshair" position="0 0 -1" radius-inner="0.01" radius-outer="0.015"
                color="#00ff88" material="shader: flat; opacity: 0.8"></a-ring>
        <!-- HUD -->
        <a-text id="hud-score" value="Score: 0" position="-0.45 0.3 -1"
                scale="0.35 0.35 0.35" color="#00ff88" font="mozillavr" align="left"></a-text>
        <a-text id="hud-timer" value="60" position="0.45 0.3 -1"
                scale="0.35 0.35 0.35" color="#ffaa00" font="mozillavr" align="right"></a-text>
        <a-text id="hud-combo" value="" position="0 0.2 -1"
                scale="0.3 0.3 0.3" color="#ff44aa" font="mozillavr" align="center"></a-text>
        <!-- V2 HUD elements -->
        <a-text id="hud-lives" value="" position="-0.45 0.22 -1"
                scale="0.25 0.25 0.25" color="#ff4444" font="mozillavr" align="left"></a-text>
        <a-text id="hud-weapon" value="" position="0.45 0.22 -1"
                scale="0.2 0.2 0.2" color="#aaaaff" font="mozillavr" align="right"></a-text>
        <a-text id="hud-level" value="" position="-0.45 0.35 -1"
                scale="0.2 0.2 0.2" color="#ffd700" font="mozillavr" align="left"></a-text>
        <!-- Boss Health Bar HUD -->
        <a-entity id="hud-boss" visible="false" position="0 -0.25 -1">
          <a-plane id="boss-bar-bg" width="0.5" height="0.03" color="#330000"
                   material="shader: flat; opacity: 0.7"></a-plane>
          <a-plane id="boss-bar-fill" width="0.5" height="0.025" color="#ff3333"
                   material="shader: flat" position="0 0 0.001"></a-plane>
          <a-text id="boss-bar-label" value="BOSS" position="0 0.03 0"
                  scale="0.15 0.15 0.15" color="#ff6666" font="mozillavr" align="center"></a-text>
        </a-entity>
        <!-- Non-VR cursor -->
        <a-cursor color="#00ff88" fuse="false" raycaster="objects: .target; far: 100"></a-cursor>
      </a-camera>

      <!-- Left controller -->
      <a-entity id="left-hand"
                oculus-touch-controls="hand: left"
                laser-controls="hand: left; model: false"
                raycaster="objects: .target; far: 50; lineColor: #44aaff; lineOpacity: 0.5"
                shoot-controls="hand: left">
      </a-entity>

      <!-- Right controller -->
      <a-entity id="right-hand"
                oculus-touch-controls="hand: right"
                laser-controls="hand: right; model: false"
                raycaster="objects: .target; far: 50; lineColor: #ff4444; lineOpacity: 0.7"
                shoot-controls="hand: right">
      </a-entity>
    </a-entity>

    <!-- Environment -->
    <a-sky color="#0a0a1a"></a-sky>

    <!-- Grid floor -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="100" height="100"
             material="color: #111133; wireframe: false" shadow="receive: true"></a-plane>
    <a-entity id="floor-grid" position="0 0.01 0" rotation="-90 0 0">
      <a-plane width="30" height="30" material="color: #1a1a4e; wireframe: true; wireframeLinewidth: 1; opacity: 0.3"
               segments-width="30" segments-height="30"></a-plane>
    </a-entity>

    <!-- Arena walls -->
    <a-box position="0 2 -15" width="30" height="5" depth="0.1"
           material="color: #0044aa; opacity: 0.15; shader: flat"></a-box>
    <a-box position="-15 2 0" width="0.1" height="5" depth="30"
           material="color: #0044aa; opacity: 0.15; shader: flat"></a-box>
    <a-box position="15 2 0" width="0.1" height="5" depth="30"
           material="color: #0044aa; opacity: 0.15; shader: flat"></a-box>
    <a-box position="0 2 15" width="30" height="5" depth="0.1"
           material="color: #0044aa; opacity: 0.15; shader: flat"></a-box>

    <!-- Lighting -->
    <a-light type="ambient" color="#222244" intensity="0.4"></a-light>
    <a-light type="point" position="0 10 0" intensity="1.2" color="#4466ff" distance="40"></a-light>
    <a-light type="point" position="-8 6 -8" intensity="0.6" color="#ff4444" distance="25"></a-light>
    <a-light type="point" position="8 6 -8" intensity="0.6" color="#44ff44" distance="25"></a-light>
    <a-light type="point" position="0 4 8" intensity="0.4" color="#ff88ff" distance="20"></a-light>

    <!-- Decorative pillars -->
    <a-cylinder position="-14 2 -14" radius="0.3" height="4" color="#1a1a4e"
                material="shader: flat; opacity: 0.5"></a-cylinder>
    <a-cylinder position="14 2 -14" radius="0.3" height="4" color="#1a1a4e"
                material="shader: flat; opacity: 0.5"></a-cylinder>
    <a-cylinder position="-14 2 14" radius="0.3" height="4" color="#1a1a4e"
                material="shader: flat; opacity: 0.5"></a-cylinder>
    <a-cylinder position="14 2 14" radius="0.3" height="4" color="#1a1a4e"
                material="shader: flat; opacity: 0.5"></a-cylinder>

    <!-- Target container -->
    <a-entity id="target-container"></a-entity>
  </a-scene>

  <script type="module" src="./js/game-main.js"></script>
</body>
</html>
